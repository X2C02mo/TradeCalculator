<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trader Calculator</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #ffffff;
            --text-secondary: #aaaaaa;
            --accent: #3390ec;
            --accent-hover: #2775c9;
            --danger: #ff5252;
            --success: #4caf50;
            --border: #333333;
            --font-main: 'Inter', sans-serif;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            font-size: 14px;
            line-height: 1.5;
            padding-bottom: 80px;
        }
        .container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        h1 {
            font-size: 18px;
            font-weight: 600;
        }
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
            margin-bottom: 20px;
            scrollbar-width: none;
        }
        .nav-tabs::-webkit-scrollbar {
            display: none;
        }
        .tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .input-group {
            margin-bottom: 12px;
        }
        .input-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-size: 12px;
        }
        .input-row {
            display: flex;
            gap: 10px;
        }
        input, select {
            width: 100%;
            background: #2c2c2c;
            border: 1px solid var(--border);
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        input:focus {
            border-color: var(--accent);
        }
        .btn {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            text-align: center;
            transition: background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            background: var(--accent-hover);
        }
        .btn-secondary {
            background: #2c2c2c;
            color: var(--text-color);
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            width: auto;
        }
        .result-box {
            background: #2c2c2c;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 13px;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            align-items: center;
        }
        .result-row:last-child {
            margin-bottom: 0;
            font-weight: 600;
            color: var(--accent);
        }
        .copy-icon {
            cursor: pointer;
            margin-left: 5px;
            opacity: 0.7;
            font-size: 12px;
        }
        .premium-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        @media (min-width: 500px) {
            .premium-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .plan-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .plan-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }
        .plan-price {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .plan-price span {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
        }
        .plan-features {
            list-style: none;
            font-size: 13px;
            color: var(--text-secondary);
            flex-grow: 1;
        }
        .plan-features li {
            margin-bottom: 6px;
            display: flex;
            align-items: flex-start;
            gap: 6px;
        }
        .payment-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        .theme-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .theme-option {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
        }
        .theme-option.selected {
            border-color: var(--accent);
            background: rgba(51, 144, 236, 0.1);
        }
        .loader {
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: none;
            animation: rotation 1s linear infinite;
        }
        .btn.loading .loader {
            display: block;
        }
        .btn.loading .btn-text {
            display: none;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .gauge-container {
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            position: relative;
        }
        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), #ffeb3b, var(--success));
            width: 50%;
            transition: width 0.5s;
        }
        .gauge-marker {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #fff;
            left: 50%;
            transition: left 0.5s;
        }
        .social-links {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .social-btn {
            flex: 1;
            text-decoration: none;
            background: var(--card-bg);
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 12px;
            border: 1px solid var(--border);
        }
        .dca-entry {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        .dca-entry input {
            padding: 8px;
        }
        .remove-entry {
            background: var(--danger);
            color: #fff;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 11px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        .close-modal {
            margin-top: 15px;
            background: var(--border);
        }
        .trade-card-preview {
            background: #2c2c2c;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid var(--border);
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-item {
            padding: 8px;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }
        .premium-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .premium-nav .btn {
            width: auto;
            flex: 1;
        }
        .info-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .chart-placeholder {
            height: 150px;
            background: #2c2c2c;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Trader Calculator</h1>
        <div style="display: flex; gap: 10px;">
            <span id="lang-toggle" style="cursor: pointer;">RU</span>
            <span id="theme-toggle" style="cursor: pointer;">üåô</span>
        </div>
    </header>

    <div class="nav-tabs">
        <div class="tab-btn active" data-tab="dca">üìä DCA</div>
        <div class="tab-btn" data-tab="rr">‚öñÔ∏è R/R</div>
        <div class="tab-btn" data-tab="capital">üí∞ Capital</div>
        <div class="tab-btn" data-tab="indicators">üìà Indicators</div>
        <div class="tab-btn" data-tab="card">üÉè Card</div>
        <div class="tab-btn" data-tab="premium">üíé Premium</div>
        <div class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</div>
    </div>

    <div id="dca" class="section active">
        <div class="card">
            <div class="card-title">DCA Calculator</div>
            <p class="info-text">Add multiple entries to calculate average price, total volume and cost.</p>
            <div id="dca-entries">
                <div class="dca-entry">
                    <input type="number" placeholder="Price" class="dca-price">
                    <input type="number" placeholder="Amount" class="dca-amount">
                    <button class="remove-entry" onclick="removeDcaEntry(this)">√ó</button>
                </div>
            </div>
            <div class="input-row" style="margin-bottom: 10px;">
                <button class="btn btn-secondary" onclick="addDcaEntry()">Add entry</button>
                <button class="btn btn-danger btn-small" onclick="clearDcaEntries()">Clear</button>
                <button class="btn btn-secondary btn-small" onclick="saveDcaEntries()">Save</button>
            </div>
            <button class="btn" onclick="calculateDCA()">Calculate</button>
            
            <div class="result-box" id="dca-result" style="display: none;">
                <div class="result-row"><span>Average price</span> <span><span id="res-avg-price">‚Äî</span><span class="copy-icon" onclick="copyText('res-avg-price')">üìã</span></span></div>
                <div class="result-row"><span>Total volume</span> <span><span id="res-total-vol">‚Äî</span><span class="copy-icon" onclick="copyText('res-total-vol')">üìã</span></span></div>
                <div class="result-row"><span>Total cost</span> <span><span id="res-total-cost">‚Äî</span><span class="copy-icon" onclick="copyText('res-total-cost')">üìã</span></span></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">DCA Goal <span style="font-size: 12px; color: var(--text-secondary);">optional</span></div>
            <div class="input-group">
                <label>Target avg price</label>
                <input type="number" id="dca-target" placeholder="Optional">
            </div>
            <button class="btn" onclick="calcDcaGoal()">Calculate Next Buy</button>
            <div class="result-box" id="dca-goal-result" style="display: none;">
                <div class="result-row"><span>Next buy price</span> <span id="res-next-price">‚Äî</span></div>
                <div class="result-row"><span>Needed volume at next price</span> <span><span id="res-needed-vol">‚Äî</span><span class="copy-icon" onclick="copyText('res-needed-vol')">üìã</span></span></div>
            </div>
        </div>
    </div>

    <div id="rr" class="section">
        <div class="card">
            <div class="card-title">Risk/Reward</div>
            <div class="input-group">
                <label>Entry</label>
                <input type="number" id="rr-entry" placeholder="0">
            </div>
            <div class="input-group">
                <label>Stop Loss</label>
                <input type="number" id="rr-sl" placeholder="0">
            </div>
            <div class="input-group">
                <label>Take Profit</label>
                <input type="number" id="rr-tp" placeholder="0">
            </div>
            <div class="input-group">
                <label>Fee % (entry+exit)</label>
                <input type="number" id="rr-fee" placeholder="0.1" value="0.1">
            </div>
            <div class="input-row" style="margin-bottom: 10px;">
                <button class="btn btn-secondary btn-small" onclick="saveRR()">Save</button>
            </div>
            <button class="btn" onclick="calculateRR()">Calculate</button>
            <div class="result-box" id="rr-result" style="display: none;">
                <div class="result-row"><span>Gross R/R</span> <span><span id="res-gross-rr">‚Äî</span><span class="copy-icon" onclick="copyText('res-gross-rr')">üìã</span></span></div>
                <div class="result-row"><span>Net R/R (with fees)</span> <span><span id="res-net-rr">‚Äî</span><span class="copy-icon" onclick="copyText('res-net-rr')">üìã</span></span></div>
            </div>
        </div>
    </div>

    <div id="capital" class="section">
        <div class="card">
            <div class="card-title">Capital Management</div>
            <div class="input-group">
                <label>Deposit</label>
                <input type="number" id="cap-deposit" placeholder="1000">
            </div>
            <div class="input-group">
                <label>Risk %</label>
                <div class="input-row">
                    <input type="number" id="cap-risk" placeholder="1">
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-secondary btn-small" onclick="setRisk(0.5)">0.5%</button>
                        <button class="btn btn-secondary btn-small" onclick="setRisk(1)">1%</button>
                        <button class="btn btn-secondary btn-small" onclick="setRisk(2)">2%</button>
                        <button class="btn btn-secondary btn-small" onclick="setRisk(3)">3%</button>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label>Leverage</label>
                <input type="number" id="cap-leverage" placeholder="1">
            </div>
            <div class="input-group">
                <label>Entry</label>
                <input type="number" id="cap-entry" placeholder="0">
            </div>
            <div class="input-group">
                <label>Stop Loss</label>
                <input type="number" id="cap-sl" placeholder="0">
            </div>
            <div class="input-group">
                <label>Fee % (entry+exit)</label>
                <input type="number" id="cap-fee" placeholder="0.1">
            </div>
            <div class="input-row" style="margin-bottom: 10px;">
                <button class="btn btn-secondary btn-small" onclick="saveCapital()">Save</button>
            </div>
            <button class="btn" onclick="calculateCapital()">Calculate</button>
            <div class="result-box" id="cap-result" style="display: none;">
                <div class="result-row"><span>Position size</span> <span><span id="res-pos-size">‚Äî</span><span class="copy-icon" onclick="copyText('res-pos-size')">üìã</span></span></div>
                <div class="result-row"><span>Risk $</span> <span><span id="res-risk-usd">‚Äî</span><span class="copy-icon" onclick="copyText('res-risk-usd')">üìã</span></span></div>
                <div class="result-row"><span>Margin (with leverage)</span> <span><span id="res-margin">‚Äî</span><span class="copy-icon" onclick="copyText('res-margin')">üìã</span></span></div>
            </div>
        </div>
    </div>

    <div id="indicators" class="section">
        <div class="card">
            <div class="card-title">Market Indicators <button class="btn-secondary btn-small" style="border:none;" onclick="refreshIndicators()">üîÑ</button></div>
            <div class="input-group">
                <label>Fear & Greed Index</label>
                <div class="gauge-container">
                    <div class="gauge-fill" id="fg-fill"></div>
                    <div class="gauge-marker" id="fg-marker"></div>
                </div>
                <div style="text-align: center; margin-top: 5px; font-weight: bold;" id="fg-text">‚Äî</div>
            </div>
            <div class="result-box">
                <div class="result-row"><span>Market Mood</span> <span id="ind-mood">‚Äî</span></div>
                <div class="result-row"><span>Total Market Cap</span> <span id="ind-cap">‚Äî</span></div>
                <div class="result-row"><span>Altcoin Dominance</span> <span id="ind-dom">‚Äî</span></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">Fear & Greed Gauge</div>
            <div class="gauge-container">
                <div class="gauge-fill" id="fg2-fill"></div>
                <div class="gauge-marker" id="fg2-marker"></div>
            </div>
            <div class="result-row" style="margin-top: 10px;"><span>Current</span> <span id="fg2-val">‚Äî</span></div>
        </div>
        <div class="card">
            <div class="card-title">Dominance Split</div>
            <div class="result-box">
                <div class="result-row"><span>BTC</span> <span id="dom-btc">‚Äî</span></div>
                <div class="result-row"><span>ETH</span> <span id="dom-eth">‚Äî</span></div>
                <div class="result-row"><span>Others</span> <span id="dom-other">‚Äî</span></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">ü§ñ AI Tips</div>
            <div class="result-box" id="ai-tip-box" style="min-height: 60px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                ‚Äî
            </div>
            <button class="btn" style="margin-top: 10px;" onclick="getAiTip()">Get new tip <span style="font-size: 10px; opacity: 0.7;">(Premium only)</span></button>
        </div>
        <div class="card">
            <div class="card-title">üìú History</div>
            <div class="history-list" id="history-list">
                <div class="history-item"><span>No history yet</span></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">Trade Analytics</div>
            <div class="chart-placeholder">Chart Preview</div>
            <div class="result-box">
                <div class="result-row"><span>Win Rate</span> <span id="analytics-win">‚Äî</span></div>
                <div class="result-row"><span>Profit Factor</span> <span id="analytics-pf">‚Äî</span></div>
            </div>
        </div>
    </div>

    <div id="card" class="section">
        <div class="card">
            <div class="card-title">üÉè Trade Card</div>
            <div class="input-group">
                <label>Pair</label>
                <input type="text" id="card-pair" placeholder="BTC/USDT">
            </div>
            <div class="input-group">
                <label>Direction</label>
                <select id="card-direction">
                    <option value="LONG">LONG</option>
                    <option value="SHORT">SHORT</option>
                </select>
            </div>
            <div class="input-row">
                <button class="btn btn-secondary" onclick="generateCard()">Generate</button>
                <button class="btn btn-secondary" onclick="saveCardPNG()">Save PNG</button>
                <button class="btn btn-secondary" onclick="copyCardData()">Copy</button>
            </div>
            <div class="trade-card-preview" id="trade-card" style="display: none;">
                <div style="font-weight: bold; margin-bottom: 5px;" id="tc-pair">BTC/USDT</div>
                <div style="color: var(--accent);" id="tc-direction">LONG</div>
                <div style="font-size: 12px; color: var(--text-secondary);">Entry: <span id="tc-entry">‚Äî</span></div>
                <div style="font-size: 12px; color: var(--text-secondary);">TP: <span id="tc-tp">‚Äî</span></div>
                <div style="font-size: 12px; color: var(--text-secondary);">SL: <span id="tc-sl">‚Äî</span></div>
            </div>
            <p class="info-text" style="margin-top: 10px;">Use Save PNG for smartphones, Copy for computers</p>
        </div>
    </div>

    <div id="premium" class="section">
        <div class="premium-nav">
            <button class="btn btn-secondary" onclick="switchTab('dca')">‚Üê Back to Calculator</button>
        </div>
        <div class="card">
            <div class="card-title">Premium Features</div>
            <p class="info-text">Unlock all premium features for advanced trading.</p>
            <div class="premium-grid">
                <div class="plan-card">
                    <div class="plan-header">Premium-status for 30 days</div>
                    <div class="plan-price">1 TON <span>89 Stars</span></div>
                    <p class="info-text">Unlock all premium features for 30 days.</p>
                    <ul class="plan-features">
                        <li>‚úÖ Advanced Analytics</li>
                        <li>‚úÖ AI Tips</li>
                        <li>‚úÖ Secret Achievements</li>
                        <li>‚úÖ Personalization</li>
                        <li>‚úÖ Premium Themes</li>
                        <li>‚úÖ Priority Support</li>
                    </ul>
                    <div class="payment-buttons">
                        <button class="btn" onclick="processPayment(this, 1500)"><span class="btn-text">Pay 1 TON</span><div class="loader"></div></button>
                        <button class="btn btn-secondary" onclick="processPayment(this, 1500)"><span class="btn-text">Pay 89 Stars</span><div class="loader"></div></button>
                    </div>
                </div>
                <div class="plan-card">
                    <div class="plan-header">Lifetime</div>
                    <div class="plan-price">4 TON <span>389 Stars</span></div>
                    <p class="info-text">One-time purchase, no expiration.</p>
                    <ul class="plan-features">
                        <li>‚úÖ All 30 Days features</li>
                        <li>‚úÖ Lifetime Updates</li>
                        <li>‚úÖ Exclusive Badge</li>
                    </ul>
                    <div class="payment-buttons">
                        <button class="btn" onclick="processPayment(this, 2000)"><span class="btn-text">Pay 4 TON</span><div class="loader"></div></button>
                        <button class="btn btn-secondary" onclick="processPayment(this, 2000)"><span class="btn-text">Pay 389 Stars</span><div class="loader"></div></button>
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; font-size: 11px; color: var(--text-secondary); text-align: center;">
                Payments are processed inside Telegram. After successful payment, Premium will be activated on this device.
            </div>
            <button class="btn btn-secondary" style="margin-top: 10px;" onclick="checkPayment()">Check payment</button>
        </div>
        <div class="card">
            <div class="card-title">What you get</div>
            <ul class="plan-features">
                <li>‚úÖ Advanced Analytics ‚Äì deep trade statistics, charts, reports</li>
                <li>‚úÖ AI tips ‚Äì entry/exit recommendations based on market data</li>
                <li>‚úÖ Secret achievements + ranks ‚Äì unique badges and levels</li>
                <li>‚úÖ Personalization ‚Äì custom colors, fonts, widgets</li>
                <li>‚úÖ Premium themes ‚Äì exclusive color schemes (Neon, Gold, Midnight)</li>
                <li>‚úÖ Priority Support ‚Äì faster responses</li>
            </ul>
        </div>
        <div class="card">
            <div class="card-title">Premium themes</div>
            <div class="theme-selector">
                <div class="theme-option" onclick="selectTheme(this, 'neon')">Neon</div>
                <div class="theme-option" onclick="selectTheme(this, 'gold')">Gold</div>
                <div class="theme-option" onclick="selectTheme(this, 'midnight')">Midnight Pro</div>
            </div>
            <p class="info-text" style="margin-top: 10px;">Themes apply instantly (premium required).</p>
        </div>
    </div>

    <div id="settings" class="section">
        <div class="card">
            <div class="card-title">üåê Settings</div>
            <div class="input-row" style="margin-bottom: 10px;">
                <button class="btn btn-secondary" id="lang-ru" onclick="setLang('ru')">RU</button>
                <button class="btn btn-secondary" id="lang-en" onclick="setLang('en')">EN</button>
                <button class="btn btn-secondary" id="theme-dark" onclick="setTheme('dark')">üåô Dark</button>
            </div>
            <p class="info-text">Language and theme are saved to your account.</p>
            <div class="input-group">
                <label>‚úíÔ∏è Font <span style="color: var(--accent);">(Premium)</span></label>
                <select id="setting-font">
                    <option value="Inter">Inter</option>
                    <option value="Roboto">Roboto</option>
                </select>
            </div>
            <button class="btn" onclick="saveSettings()">Save</button>
        </div>
        <div class="card">
            <div class="card-title">üèÜ Achievements</div>
            <div class="result-box">
                <div class="result-row"><span>Progress</span> <span id="ach-progress">‚Äî</span></div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">üí¨ Support</div>
            <p class="info-text">Connect your wallet for tips and donations. Contact us through the links below.</p>
            <button class="btn btn-secondary" onclick="connectWallet()">Connect Wallet</button>
            <div class="result-box" style="margin-top: 10px;">
                <div class="result-row"><span>Tip 0.05 TON</span></div>
            </div>
            <div class="result-box" style="margin-top: 10px;">
                <div class="result-row"><span>Priority Support (Premium)</span></div>
            </div>
            <div class="social-links">
                <a href="https://t.me/ChalovCrypto" class="social-btn">TELEGRAM</a>
                <a href="https://www.youtube.com/@ChalovCrypto" class="social-btn">YOUTUBE</a>
            </div>
            <div style="margin-top: 15px; font-size: 11px; color: var(--text-secondary); display: flex; gap: 10px; justify-content: center;">
                <span>Terms</span>
                <span>Privacy</span>
                <span>Contact</span>
            </div>
        </div>
    </div>

    <div class="footer">
        AIRDROP ‚Ä¢ NEWS ‚Ä¢ TRADING<br>
        &copy; 2024 Trader Calculator
    </div>
</div>

<div id="payment-modal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">Payment</h3>
        <p id="modal-msg" style="margin: 15px 0; color: var(--text-secondary);">Processing...</p>
        <button class="btn close-modal" onclick="closeModal()">Close</button>
    </div>
</div>

<script>
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.section');

    function switchTab(tabId) {
        tabs.forEach(t => {
            t.classList.remove('active');
            if(t.dataset.tab === tabId) t.classList.add('active');
        });
        sections.forEach(s => {
            s.classList.remove('active');
            if(s.id === tabId) s.classList.add('active');
        });
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            switchTab(tab.dataset.tab);
        });
    });

    function addDcaEntry() {
        const container = document.getElementById('dca-entries');
        const div = document.createElement('div');
        div.className = 'dca-entry';
        div.innerHTML = `
            <input type="number" placeholder="Price" class="dca-price">
            <input type="number" placeholder="Amount" class="dca-amount">
            <button class="remove-entry" onclick="removeDcaEntry(this)">√ó</button>
        `;
        container.appendChild(div);
    }

    function removeDcaEntry(btn) {
        const entries = document.querySelectorAll('.dca-entry');
        if (entries.length > 1) {
            btn.parentElement.remove();
        }
    }

    function clearDcaEntries() {
        const container = document.getElementById('dca-entries');
        container.innerHTML = `
            <div class="dca-entry">
                <input type="number" placeholder="Price" class="dca-price">
                <input type="number" placeholder="Amount" class="dca-amount">
                <button class="remove-entry" onclick="removeDcaEntry(this)">√ó</button>
            </div>
        `;
        document.getElementById('dca-result').style.display = 'none';
    }

    function saveDcaEntries() {
        alert('DCA entries saved');
    }

    function calculateDCA() {
        const prices = document.querySelectorAll('.dca-price');
        const amounts = document.querySelectorAll('.dca-amount');
        let totalCost = 0;
        let totalVol = 0;

        for (let i = 0; i < prices.length; i++) {
            const p = parseFloat(prices[i].value);
            const a = parseFloat(amounts[i].value);
            if (p && a) {
                totalCost += p * a;
                totalVol += a;
            }
        }

        if (totalVol > 0) {
            const avg = totalCost / totalVol;
            document.getElementById('res-avg-price').innerText = avg.toFixed(4);
            document.getElementById('res-total-vol').innerText = totalVol.toFixed(4);
            document.getElementById('res-total-cost').innerText = totalCost.toFixed(2);
            document.getElementById('dca-result').style.display = 'block';
            addToHistory('DCA Calculation');
        }
    }

    function calcDcaGoal() {
        const target = parseFloat(document.getElementById('dca-target').value);
        const currentAvg = parseFloat(document.getElementById('res-avg-price').innerText);
        const currentVol = parseFloat(document.getElementById('res-total-vol').innerText);
        const currentCost = parseFloat(document.getElementById('res-total-cost').innerText);

        if (target && currentAvg && currentVol) {
            const neededCost = target * currentVol * 2; 
            const neededVol = (neededCost - currentCost) / target;
            if(neededVol > 0) {
                document.getElementById('res-next-price').innerText = target.toFixed(4);
                document.getElementById('res-needed-vol').innerText = neededVol.toFixed(4);
                document.getElementById('dca-goal-result').style.display = 'block';
            }
        }
    }

    function saveRR() {
        alert('R/R settings saved');
    }

    function calculateRR() {
        const entry = parseFloat(document.getElementById('rr-entry').value);
        const sl = parseFloat(document.getElementById('rr-sl').value);
        const tp = parseFloat(document.getElementById('rr-tp').value);
        const fee = parseFloat(document.getElementById('rr-fee').value) || 0;

        if (entry && sl && tp) {
            const risk = Math.abs(entry - sl);
            const reward = Math.abs(tp - entry);
            const gross = reward / risk;
            const feeImpact = (entry * (fee / 100)) * 2; 
            const netReward = reward - feeImpact;
            const net = netReward / risk;

            document.getElementById('res-gross-rr').innerText = gross.toFixed(2);
            document.getElementById('res-net-rr').innerText = net.toFixed(2);
            document.getElementById('rr-result').style.display = 'block';
            addToHistory('R/R Calculation');
        }
    }

    function setRisk(val) {
        document.getElementById('cap-risk').value = val;
    }

    function saveCapital() {
        alert('Capital settings saved');
    }

    function calculateCapital() {
        const deposit = parseFloat(document.getElementById('cap-deposit').value);
        const riskPct = parseFloat(document.getElementById('cap-risk').value);
        const leverage = parseFloat(document.getElementById('cap-leverage').value) || 1;
        const entry = parseFloat(document.getElementById('cap-entry').value);
        const sl = parseFloat(document.getElementById('cap-sl').value);

        if (deposit && riskPct && entry && sl) {
            const riskUsd = deposit * (riskPct / 100);
            const dist = Math.abs(entry - sl);
            const posSize = riskUsd / dist;
            const margin = posSize / leverage;

            document.getElementById('res-pos-size').innerText = posSize.toFixed(4);
            document.getElementById('res-risk-usd').innerText = riskUsd.toFixed(2);
            document.getElementById('res-margin').innerText = margin.toFixed(2);
            document.getElementById('cap-result').style.display = 'block';
            addToHistory('Capital Calculation');
        }
    }

    function refreshIndicators() {
        const mood = ['Fear', 'Neutral', 'Greed'];
        const randomMood = mood[Math.floor(Math.random() * mood.length)];
        const randomVal = Math.floor(Math.random() * 100);
        
        document.getElementById('fg-text').innerText = randomVal;
        document.getElementById('fg-fill').style.width = randomVal + '%';
        document.getElementById('fg-marker').style.left = randomVal + '%';
        
        document.getElementById('fg2-val').innerText = randomVal;
        document.getElementById('fg2-fill').style.width = randomVal + '%';
        document.getElementById('fg2-marker').style.left = randomVal + '%';
        
        document.getElementById('ind-mood').innerText = randomMood;
        document.getElementById('ind-cap').innerText = '$' + (Math.random() * 5 + 2).toFixed(2) + 'T';
        document.getElementById('ind-dom').innerText = (Math.random() * 10 + 40).toFixed(1) + '%';
        
        document.getElementById('dom-btc').innerText = (Math.random() * 10 + 45).toFixed(1) + '%';
        document.getElementById('dom-eth').innerText = (Math.random() * 5 + 15).toFixed(1) + '%';
        document.getElementById('dom-other').innerText = (100 - parseFloat(document.getElementById('dom-btc').innerText) - parseFloat(document.getElementById('dom-eth').innerText)).toFixed(1) + '%';
        
        document.getElementById('analytics-win').innerText = (Math.random() * 30 + 50).toFixed(1) + '%';
        document.getElementById('analytics-pf').innerText = (Math.random() * 2 + 1).toFixed(2);
    }

    function getAiTip() {
        const box = document.getElementById('ai-tip-box');
        box.innerText = 'Loading...';
        setTimeout(() => {
            box.innerText = 'Market shows signs of consolidation. Wait for breakout confirmation.';
        }, 1000);
    }

    function processPayment(btn, duration) {
        btn.classList.add('loading');
        btn.disabled = true;
        setTimeout(() => {
            btn.classList.remove('loading');
            btn.disabled = false;
            showModal('Success', 'Payment processed successfully. Premium activated.');
        }, duration);
    }

    function checkPayment() {
        showModal('Check Payment', 'Verifying transaction...');
        setTimeout(() => {
            closeModal();
        }, 2000);
    }

    function selectTheme(el, theme) {
        document.querySelectorAll('.theme-option').forEach(t => t.classList.remove('selected'));
        el.classList.add('selected');
    }

    function generateCard() {
        const pair = document.getElementById('card-pair').value || 'BTC/USDT';
        const direction = document.getElementById('card-direction').value;
        const entry = (Math.random() * 1000 + 50000).toFixed(2);
        const tp = (parseFloat(entry) * 1.05).toFixed(2);
        const sl = (parseFloat(entry) * 0.95).toFixed(2);
        
        document.getElementById('tc-pair').innerText = pair;
        document.getElementById('tc-direction').innerText = direction;
        document.getElementById('tc-entry').innerText = entry;
        document.getElementById('tc-tp').innerText = tp;
        document.getElementById('tc-sl').innerText = sl;
        document.getElementById('trade-card').style.display = 'block';
    }

    function saveCardPNG() {
        alert('PNG saved (simulation)');
    }

    function copyCardData() {
        alert('Card data copied');
    }

    function setLang(lang) {
        document.getElementById('lang-ru').classList.remove('active');
        document.getElementById('lang-en').classList.remove('active');
        document.getElementById('lang-' + lang).classList.add('active');
    }

    function setTheme(theme) {
        document.getElementById('theme-dark').classList.remove('active');
    }

    function saveSettings() {
        alert('Settings saved');
    }

    function connectWallet() {
        alert('Wallet connection initiated...');
    }

    function copyText(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text);
    }

    function addToHistory(action) {
        const list = document.getElementById('history-list');
        const item = document.createElement('div');
        item.className = 'history-item';
        const time = new Date().toLocaleTimeString();
        item.innerHTML = `<span>${action}</span> <span style="color: var(--text-secondary);">${time}</span>`;
        list.insertBefore(item, list.firstChild);
        if(list.children.length > 10) {
            list.removeChild(list.lastChild);
        }
    }

    function showModal(title, msg) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-msg').innerText = msg;
        document.getElementById('payment-modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('payment-modal').style.display = 'none';
    }

    refreshIndicators();
</script>
</body>
</html>
