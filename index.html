<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Trader Calculator</title>


<script src="https://telegram.org/js/telegram-web-app.js"></script>


<script src="https://unpkg.com/@tonconnect/ui@2.3.1/dist/tonconnect-ui.min.js"></script>


<script 
    async 
    src="https://tganalytics.xyz/index.js" 
    onload="initAnalytics()" 
    type="text/javascript"
></script>

<script>
    function initAnalytics() {
        if (window.telegramAnalytics) {
            window.telegramAnalytics.init({
                token: 'eyJhcHBfbmFtZSI6IkNhbGN1bGF0b3JUcmFkZXIiLCJhcHBfdXJsIjoiaHR0cHM6Ly90Lm1lL0NhbGN1bGF0b3JUcmFkZXJCb3QiLCJhcHBfZG9tYWluIjoiaHR0cHM6Ly90cmFkZS1jYWxjdWxhdG9yLWZpdmUudmVyY2VsLmFwcCJ9!zWnEmg/2eMVbB1RuP0DEIz1FSSOi0Q5+a4V/NZcCNB0=',
                appName: 'CalculatorTrader'
            });
            console.log('Telegram Analytics SDK initialized successfully');
            
            
            window.telegramAnalytics.trackEvent('app_launch', {
                platform: navigator.platform
            });
        } else {
            console.error('Telegram Analytics SDK failed to load');
        }
    }
</script>
<style>
:root {
--bg: #0a0a0a;
--panel: #111111;
--border: #252525;
--text: #ffffff;
--muted: #a0a0a0;
--accent: #7CFC00;
--accent-rgb: 124, 252, 0;
--chip: #1a1a1a;
--danger: #ff4d4d;
--success: #22c55e;
--radius: 14px;
--shadow: 0 10px 28px rgba(0,0,0,0.45);
--shadow-soft: 0 6px 18px rgba(0,0,0,0.25);
--input-bg: #0d0d0d;
--result-bg: #0f0f0f;
--pulse-color: var(--accent);
--glass: rgba(255,255,255,0.03);
--glass-strong: rgba(255,255,255,0.06);
--blur: 10px;
}
html[data-theme="light"] {
--bg: #f5f7fa;
--panel: #ffffff;
--border: #e1e5eb;
--text: #1a1a1a;
--muted: #666666;
--accent: #2d8cff;
--accent-rgb: 45, 140, 255;
--chip: #f0f2f5;
--danger: #ef4444;
--success: #10b981;
--shadow: 0 8px 24px rgba(0,0,0,0.08);
--input-bg: #fafbfc;
--result-bg: #f8f9fa;
}
* {
box-sizing: border-box;
margin: 0;
padding: 0;
}
html, body {
height: 100%;
background: var(--bg);
color: var(--text);
font-family: 'Inter', system-ui, -apple-system, sans-serif;
overflow-x: hidden;
}
body::before{
content:'';
position: fixed;
inset: -20%;
pointer-events: none;
z-index: -1;
background:
radial-gradient(900px 450px at 15% 15%, rgba(var(--accent-rgb),0.18), transparent 55%),
radial-gradient(900px 450px at 85% 25%, rgba(var(--accent-rgb),0.10), transparent 55%),
radial-gradient(900px 520px at 50% 90%, rgba(var(--accent-rgb),0.08), transparent 55%);
}
#app {
min-height: 100vh;
display: flex;
flex-direction: column;
}
header {
position: sticky;
top: 0;
z-index: 100;
display: flex;
align-items: center;
justify-content: space-between;
padding: 12px 16px;
border-bottom: 1px solid var(--border);
background: var(--panel);
animation: slideDown 0.3s ease;
}
@keyframes slideDown {
from { transform: translateY(-10px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}
.leftbar {
display: flex;
align-items: center;
gap: 12px;
flex-wrap: wrap;
}
.lang {
display: flex;
gap: 4px;
background: var(--chip);
padding: 4px;
border-radius: 8px;
border: 1px solid var(--border);
animation: fadeIn 0.5s ease;
}
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}
.lang button {
background: transparent;
border: none;
color: var(--muted);
padding: 4px 12px;
cursor: pointer;
border-radius: 6px;
font-size: 13px;
font-weight: 600;
transition: all 0.2s ease;
}
.lang button.active {
background: var(--accent);
color: #000;
transform: scale(1.05);
box-shadow: 0 2px 8px rgba(124, 252, 0, 0.3);
}
.iconbtn {
border: 1px solid var(--border);
background: var(--chip);
color: var(--text);
padding: 6px 12px;
border-radius: 8px;
cursor: pointer;
font-size: 13px;
font-weight: 600;
display: inline-flex;
align-items: center;
gap: 6px;
transition: all 0.3s ease;
}
.iconbtn:hover {
border-color: var(--accent);
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
main {
flex: 1;
padding: 16px;
padding-bottom: 80px;
display: flex;
flex-direction: column;
gap: 16px;
max-width: 1200px;
margin: 0 auto;
width: 100%;
}
.main-screen {
display: none;
animation: fadeIn 0.4s ease;
}
.main-screen.active {
display: block;
}
.subtabs {
display: flex;
gap: 8px;
margin-bottom: 20px;
flex-wrap: wrap;
}
.subtab {
background: var(--chip);
border: 1px solid var(--border);
color: var(--muted);
font-size: 14px;
padding: 8px 16px;
cursor: pointer;
border-radius: 8px;
font-weight: 600;
transition: all 0.3s ease;
}
.subtab:hover {
border-color: var(--accent);
transform: translateY(-2px);
}
.subtab.active {
background: var(--accent);
color: #000;
border-color: var(--accent);
transform: scale(1.05);
box-shadow: 0 4px 12px rgba(124, 252, 0, 0.3);
}
.panels {
display: flex;
gap: 20px;
flex-wrap: wrap;
}
.screen {
display: none;
width: 100%;
animation: slideUp 0.4s ease;
}
@keyframes slideUp {
from { transform: translateY(10px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}
.screen.active {
display: block;
}
.card {
background: linear-gradient(180deg, var(--glass-strong), rgba(255,255,255,0.00) 45%), var(--panel);
backdrop-filter: blur(var(--blur));
border: 1px solid var(--border);
border-radius: var(--radius);
padding: 20px;
box-shadow: var(--shadow);
margin-bottom: 20px;
transition: all 0.3s ease;
animation: cardAppear 0.5s ease;
}
@keyframes cardAppear {
0% { transform: scale(0.95); opacity: 0; }
100% { transform: scale(1); opacity: 1; }
}
.card:hover {
transform: translateY(-4px);
box-shadow: 0 12px 32px rgba(0,0,0,0.3);
}
.card h3 {
margin: 0 0 16px 0;
font-size: 18px;
font-weight: 700;
color: var(--accent);
position: relative;
padding-left: 12px;
}
.card h3::before {
content: '';
position: absolute;
left: 0;
top: 0;
bottom: 0;
width: 4px;
background: var(--accent);
border-radius: 2px;
}
.field {
margin-bottom: 12px;
animation: fadeIn 0.5s ease;
}
label {
display: block;
font-size: 12px;
color: var(--muted);
margin-bottom: 6px;
font-weight: 600;
}
input, select {
width: 100%;
padding: 10px 12px;
background: var(--input-bg);
border: 1px solid var(--border);
color: var(--text);
border-radius: 8px;
font-size: 14px;
outline: none;
transition: all 0.2s ease;
}
input:focus, select:focus {
border-color: var(--accent);
box-shadow: 0 0 0 3px rgba(124, 252, 0, 0.1);
}
.row {
display: flex;
gap: 12px;
flex-wrap: wrap;
}
.row > * {
flex: 1;
min-width: 150px;
}
.result {
margin-top: 8px;
padding: 12px;
border-radius: 8px;
background: var(--result-bg);
border: 1px solid var(--border);
display: flex;
gap: 12px;
align-items: center;
justify-content: space-between;
transition: all 0.3s ease;
animation: pulse 3.2s infinite;
}
@keyframes pulse {
0% { box-shadow: 0 0 0 0 rgba(var(--accent-rgb), 0.22); }
70% { box-shadow: 0 0 0 7px rgba(var(--accent-rgb), 0); }
100% { box-shadow: 0 0 0 0 rgba(var(--accent-rgb), 0); }
}
.result .v {
color: var(--accent);
font-weight: 700;
font-size: 16px;
}
.small {
font-size: 11px;
color: var(--muted);
font-weight: 500;
}
.controls {
display: flex;
gap: 8px;
margin-top: 16px;
flex-wrap: wrap;
}
.btn {
background: var(--accent);
color: #000;
border: none;
padding: 8px 16px;
border-radius: 8px;
cursor: pointer;
font-weight: 600;
font-size: 13px;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}
.btn::after {
content: '';
position: absolute;
top: 50%;
left: 50%;
width: 5px;
height: 5px;
background: rgba(255, 255, 255, 0.5);
opacity: 0;
border-radius: 100%;
transform: scale(1, 1) translate(-50%);
transform-origin: 50% 50%;
}
.btn:focus:not(:active)::after {
animation: ripple 1s ease-out;
}
@keyframes ripple {
0% {
transform: scale(0, 0);
opacity: 0.5;
}
100% {
transform: scale(20, 20);
opacity: 0;
}
}
.btn:hover {
opacity: 0.9;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.btn.ghost {
background: transparent;
color: var(--muted);
border: 1px solid var(--border);
}
.btn.ghost:hover {
border-color: var(--accent);
color: var(--accent);
transform: translateY(-2px);
}
.btn.loading {
color: transparent !important;
pointer-events: none;
opacity: 0.7;
position: relative;
overflow: visible !important;
}
.btn.loading::after {
content: '';
position: absolute;
width: 20px;
height: 20px;
top: 50%;
left: 50%;
margin-left: -10px;
margin-top: -10px;
border: 2px solid rgba(0,0,0,0.2);
border-top-color: var(--accent);
border-radius: 50%;
animation: spin 0.6s linear infinite;
z-index: 10;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.chips {
display: flex;
gap: 8px;
margin-top: 12px;
flex-wrap: wrap;
}
.chip {
border: 1px solid var(--border);
background: var(--chip);
padding: 6px 12px;
border-radius: 20px;
cursor: pointer;
color: var(--muted);
font-size: 12px;
font-weight: 600;
transition: all 0.3s ease;
}
.chip:hover {
border-color: var(--accent);
transform: translateY(-2px);
}
.chip.active {
background: var(--accent);
color: #000;
border-color: var(--accent);
transform: scale(1.1);
box-shadow: 0 2px 8px rgba(124, 252, 0, 0.3);
}
.history {
background: var(--panel);
border: 1px solid var(--border);
border-radius: var(--radius);
padding: 16px;
width: 100%;
box-shadow: var(--shadow);
transition: all 0.3s ease;
}
.history:hover {
transform: translateY(-2px);
box-shadow: 0 12px 32px rgba(0,0,0,0.3);
}
.history h4 {
margin: 0 0 12px 0;
font-size: 16px;
font-weight: 700;
color: var(--accent);
}
.history-list {
display: flex;
flex-direction: column;
gap: 8px;
max-height: 300px;
overflow: auto;
}
.hist-item {
border: 1px solid var(--border);
border-radius: 8px;
padding: 12px;
display: flex;
align-items: flex-start;
justify-content: space-between;
gap: 12px;
background: var(--chip);
transition: all 0.3s ease;
}
.hist-item:hover {
border-color: var(--accent);
transform: translateX(4px);
}
.hist-item b {
display: block;
font-size: 13px;
margin-bottom: 4px;
}
.hist-actions {
display: flex;
gap: 6px;
}
.mini {
border: 1px solid var(--border);
background: transparent;
color: var(--muted);
padding: 4px 8px;
border-radius: 6px;
cursor: pointer;
font-size: 11px;
font-weight: 600;
transition: all 0.2s ease;
}
.mini:hover {
border-color: var(--accent);
color: var(--accent);
transform: scale(1.05);
}
.support-wrap {
display: flex;
flex-direction: column;
gap: 20px;
align-items: center;
padding: 20px;
}
.support-links {
display: flex;
gap: 20px;
margin-top: 16px;
}
.support-links a {
color: var(--accent);
text-decoration: none;
font-weight: 700;
font-size: 14px;
transition: all 0.3s ease;
position: relative;
padding: 8px 16px;
border-radius: 8px;
background: var(--chip);
}
.support-links a:hover {
text-decoration: none;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
background: var(--accent);
color: #000;
}
.ach-card .ach-summary{
display:flex;
gap:12px;
align-items:center;
justify-content:space-between;
flex-wrap:wrap;
margin: 12px 0 8px;
}
.ach-progress{ flex: 1; min-width: 220px; }
.ach-bar{
margin-top:8px;
height:10px;
border-radius:999px;
border:1px solid var(--border);
background: var(--result-bg);
overflow:hidden;
}
#ach_bar_fill{
height:100%;
width:0%;
background: var(--accent);
transition: width .35s ease;
}
.ach-list{ display:flex; flex-direction:column; gap:10px; margin-top: 12px; }
.ach-item{
border:1px solid var(--border);
background: linear-gradient(180deg, var(--glass), transparent 55%), var(--chip);
border-radius: 12px;
padding: 12px;
display:flex;
align-items:flex-start;
gap: 12px;
transition: all .25s ease;
}
.ach-item:hover{ border-color: var(--accent); transform: translateY(-2px); box-shadow: var(--shadow-soft); }
.ach-ico{
width: 38px; height: 38px; border-radius: 12px;
display:flex; align-items:center; justify-content:center;
font-size: 18px;
background: rgba(var(--accent-rgb),0.12);
border: 1px solid rgba(var(--accent-rgb),0.25);
flex: 0 0 auto;
}
.ach-main{ flex:1; min-width: 160px; }
.ach-title{ font-weight: 800; font-size: 13px; line-height: 1.2; }
.ach-desc{ margin-top: 4px; font-size: 12px; color: var(--muted); font-weight: 550; line-height: 1.35; }
.ach-pill{
flex: 0 0 auto;
font-size: 11px; font-weight: 800;
padding: 6px 10px;
border-radius: 999px;
border: 1px solid var(--border);
background: var(--result-bg);
color: var(--muted);
}
.ach-pill.unlocked{
border-color: rgba(var(--accent-rgb),0.35);
color: #000;
background: var(--accent);
}
.bottomnav {
position: fixed;
left: 0;
right: 0;
bottom: 0;
z-index: 100;
padding: 12px 16px;
border-top: 1px solid var(--border);
background: var(--panel);
display: flex;
justify-content: center;
animation: slideUp 0.4s ease;
}
.bottomnav .bar {
width: min(400px, 100%);
display: flex;
gap: 12px;
}
.main-tab {
flex: 1;
border: 1px solid var(--border);
background: var(--chip);
color: var(--muted);
border-radius: 8px;
padding: 10px;
cursor: pointer;
font-weight: 600;
font-size: 13px;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
transition: all 0.3s ease;
}
.main-tab:hover {
border-color: var(--accent);
transform: translateY(-2px);
}
.main-tab.active {
background: var(--accent);
color: #000;
border-color: var(--accent);
transform: scale(1.05);
box-shadow: 0 4px 12px rgba(124, 252, 0, 0.3);
}
#toast {
position: fixed;
left: 50%;
transform: translateX(-50%);
bottom: 100px;
padding: 12px 20px;
border-radius: 8px;
background: var(--panel);
color: var(--text);
font-weight: 600;
font-size: 13px;
opacity: 0;
pointer-events: none;
z-index: 1000;
border: 1px solid var(--border);
box-shadow: var(--shadow);
transition: all 0.3s ease;
}
#toast.show {
opacity: 1;
transform: translateX(-50%) translateY(-10px);
}
#modal_backdrop {
position: fixed;
inset: 0;
background: rgba(0, 0, 0, 0.7);
display: none;
align-items: center;
justify-content: center;
z-index: 999;
padding: 16px;
animation: fadeIn 0.3s ease;
}
#modal {
width: min(600px, 100%);
border-radius: 12px;
background: var(--panel);
border: 1px solid var(--border);
padding: 20px;
box-shadow: var(--shadow);
animation: scaleIn 0.3s ease;
}
@keyframes scaleIn {
from { transform: scale(0.9); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}
#modal_header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 16px;
}
#modal_header b {
font-size: 16px;
font-weight: 700;
color: var(--accent);
}
#modal_close {
border: 1px solid var(--border);
background: transparent;
border-radius: 6px;
color: var(--muted);
padding: 6px 10px;
cursor: pointer;
font-size: 16px;
transition: all 0.2s ease;
}
#modal_close:hover {
border-color: var(--accent);
color: var(--accent);
transform: rotate(90deg);
}
#modal_body {
display: flex;
gap: 16px;
flex-wrap: wrap;
}
#modal_canvas_wrap {
flex: 1;
min-width: 200px;
border: 1px solid var(--border);
border-radius: 8px;
overflow: hidden;
background: var(--result-bg);
transition: all 0.3s ease;
}
#modal_canvas_wrap:hover {
border-color: var(--accent);
transform: translateY(-2px);
}
#card_canvas {
display: block;
width: 100%;
height: 200px;
}
#modal_right {
width: 200px;
display: flex;
flex-direction: column;
gap: 8px;
}
#modal_right .btn {
width: 100%;
}
#modal_help {
font-size: 11px;
color: var(--muted);
font-weight: 500;
text-align: center;
}
.vizgrid {
display: grid;
grid-template-columns: 1fr;
gap: 16px;
margin-top: 20px;
}
.viz {
border: 1px solid var(--border);
border-radius: 8px;
padding: 16px;
background: var(--chip);
transition: all 0.3s ease;
}
.viz:hover {
border-color: var(--accent);
transform: translateY(-2px);
box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}
.viz h5 {
margin: 0 0 12px 0;
font-size: 13px;
color: var(--muted);
font-weight: 600;
}
.viz canvas {
width: 100%;
height: 120px;
display: block;
}
.color-picker {
display: flex;
gap: 8px;
margin: 20px 0;
flex-wrap: wrap;
justify-content: center;
}
.color-option {
width: 32px;
height: 32px;
border-radius: 50%;
cursor: pointer;
border: 2px solid transparent;
transition: all 0.3s ease;
}
.color-option:hover {
transform: scale(1.1);
}
.color-option.active {
border-color: var(--text);
transform: scale(1.2);
box-shadow: 0 0 0 2px var(--accent);
}
.color-option.green { background: #7CFC00; }
.color-option.blue { background: #2d8cff; }
.color-option.purple { background: #9b59b6; }
.color-option.orange { background: #ffa500; }
.color-option.pink { background: #ff6b9d; }
.color-option.teal { background: #2dd4bf; }
.color-option.yellow { background: #fbbf24; }
.color-option.red { background: #ef4444; }
.floating {
animation: float 3s ease-in-out infinite;
}
@keyframes float {
0% { transform: translateY(0px); }
50% { transform: translateY(-10px); }
100% { transform: translateY(0px); }
}
.glow {
animation: glow 2s ease-in-out infinite alternate;
}
@keyframes glow {
from { box-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent); }
to { box-shadow: 0 0 15px var(--accent), 0 0 30px var(--accent); }
}
@media (max-width: 768px) {
.panels {
flex-direction: column;
}
.history {
max-width: 100%;
}
.row > * {
min-width: 100%;
}
#modal_body {
flex-direction: column;
}
#modal_right {
width: 100%;
}
}
@media (max-width: 480px) {
#main_premium .row{flex-direction:column;}
#main_premium .row > button{width:100%;}
.premium-actions{width:100%;}
}
@media (max-width: 480px) {
.subtabs {
justify-content: center;
}
.main-tab span {
display: inline-flex !important;
align-items: center;
}
.main-tab {
padding: 8px 10px;
font-size: 12px;
gap: 6px;
}
.subtab span {
display: inline !important;
}
}
@media (max-width: 320px) {
.main-tab {
font-size: 11px;
gap: 4px;
padding: 6px 8px;
}
.main-tab span:last-child {
max-width: 60px;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
}
.premium-head{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;margin-bottom:12px}
.premium-title h2{margin:8px 0 4px 0}
.premium-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.premium-badge{display:inline-flex;gap:6px;align-items:center}
.grid2{display:grid;grid-template-columns:1fr;gap:12px}
@media (min-width: 760px){.grid2{grid-template-columns:1.2fr 1fr}}
.plan{display:flex;flex-direction:column;gap:8px}
.plan-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.pill{padding:4px 10px;border-radius:999px;background:rgba(var(--accent-rgb),.14);border:1px solid rgba(var(--accent-rgb),.22);font-weight:700}
.checklist{margin:0;padding-left:18px}
.checklist li{margin:6px 0}
.note{margin-top:10px;padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.12);border:1px dashed rgba(255,255,255,.18)}
.glass{backdrop-filter: blur(10px);-webkit-backdrop-filter: blur(10px)}
:root[data-premium-theme="neon"]{
--accent:#00ffd1;
}
:root[data-premium-theme="gold"]{
--accent:#ffd166;
}
:root[data-premium-theme="midnight"]{
--accent:#7c4dff;
}
.ach-item.locked{opacity:.55;filter:saturate(.6)}
.iconbtn.active{box-shadow:0 0 0 2px rgba(var(--accent-rgb),.35) inset}
/* Premium font options */
:root[data-font="roboto"] {
font-family: 'Roboto', system-ui, -apple-system, sans-serif;
}
:root[data-font="inter"] {
font-family: 'Inter', system-ui, -apple-system, sans-serif;
}
/* === Premium Plans Cards Styles === */
.premium-plans {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin: 20px 0;
}

.premium-plan-card {
    background: linear-gradient(135deg, rgba(0,255,136,0.1) 0%, rgba(0,255,136,0.05) 100%);
    border: 2px solid rgba(0,255,136,0.3);
    border-radius: 16px;
    padding: 20px;
    position: relative;
    overflow: hidden;
}

.premium-plan-card.lifetime {
    background: linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,215,0,0.05) 100%);
    border-color: rgba(255,215,0,0.4);
}

.premium-plan-card.recommended::after {
    content: "üî• POPULAR";
    position: absolute;
    top: 10px;
    right: -30px;
    background: linear-gradient(90deg, #00ff88, #00cc6a);
    color: #000;
    padding: 4px 40px;
    font-size: 11px;
    font-weight: bold;
    transform: rotate(45deg);
}

.plan-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    flex-wrap: wrap;
    gap: 10px;
}

.plan-title {
    font-size: 20px;
    font-weight: bold;
    color: var(--text);
}

.plan-prices {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.price-tag {
    background: rgba(0,255,136,0.2);
    border: 1px solid rgba(0,255,136,0.5);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
}

.price-tag.stars {
    background: rgba(255,193,7,0.2);
    border-color: rgba(255,193,7,0.5);
}

.plan-description {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 16px;
    line-height: 1.5;
}

.plan-payment-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.payment-btn {
    background: linear-gradient(90deg, #00ff88, #00cc6a);
    color: #000;
    border: none;
    padding: 14px 20px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    text-decoration: none;
    display: block;
}

.payment-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,255,136,0.4);
}

.payment-btn.stars {
    background: linear-gradient(90deg, #ffc107, #ff9800);
}

.payment-btn.lifetime {
    background: linear-gradient(90deg, #ffd700, #ffb300);
}

.payment-btn.lifetime:hover {
    box-shadow: 0 8px 20px rgba(255,215,0,0.4);
}

/* Features List */
.premium-features {
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    padding: 20px;
    margin-top: 30px;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
    font-size: 14px;
}

.feature-item:last-child {
    margin-bottom: 0;
}

.feature-icon {
    font-size: 18px;
    flex-shrink: 0;
}

/* Themes Grid */
.themes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
    margin-top: 15px;
}

.theme-card {
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-card:hover {
    border-color: var(--accent);
    transform: translateY(-3px);
}

.theme-card.active {
    border-color: var(--accent);
    background: rgba(0,255,136,0.1);
}

@media (max-width: 600px) {
.premium-head {
flex-wrap: wrap;
}
.premium-title {
width: 100%;
}
.premium-actions {
width: 100%;
justify-content: flex-start;
}
.card .plan-row {
flex-wrap: wrap;
}
.card .pill {
font-size: 10px;
padding: 3px 8px;
}
.card .btn {
font-size: 12px;
padding: 8px 10px;
}
.grid2 .card {
padding: 16px;
}
}
</style>
</head>
<body>
<div id="app">
<header>
<div class="leftbar">
<button class="iconbtn" id="card_btn">
<span>üÉè</span>
<span data-i18n="Card">Card</span>
</button>
<button class="iconbtn" id="premium_btn">
<span>üíé</span>
<span data-i18n="Premium">Premium</span>
</button>
<button class="iconbtn" id="settings_btn">
<span>‚öôÔ∏è</span>
<span data-i18n="Settings">Settings</span>
</button>
</div>
</header>
<main>
<section id="main_calc" class="main-screen active">
<div class="subtabs">
<button class="subtab active" data-tab="dca">
<span>üìä</span>
<span data-i18n="DCA">DCA</span>
</button>
<button class="subtab" data-tab="rr">
<span>‚öñÔ∏è</span>
<span data-i18n="R/R">R/R</span>
</button>
<button class="subtab" data-tab="cap">
<span>üí∞</span>
<span data-i18n="Capital">Capital</span>
</button>
<button class="subtab" data-tab="ind">
<span>üìà</span>
<span data-i18n="Indicators">Indicators</span>
</button>
</div>
<div class="panels">
<section id="dca" class="screen active">
<div class="card floating">
<h3 data-i18n="DCA Calculator">DCA Calculator</h3>
<div class="small" style="margin-bottom:12px" data-i18n="Add multiple entries to calculate average price, total volume and cost.">
Add multiple entries to calculate average price, total volume and cost.
</div>
<div id="dca_rows"></div>
<div class="controls">
<button class="btn" id="dca_add" data-i18n="Add entry">Add entry</button>
<button class="btn ghost" id="dca_clear" data-i18n="Clear">Clear</button>
<button class="btn ghost" id="dca_save" data-i18n="Save">Save</button>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Average price">Average price</div>
<div><span class="v" id="dca_avg">‚Äî</span></div>
</div>
<button class="btn ghost" id="dca_copy" data-i18n="Copy">Copy</button>
</div>
<div class="row">
<div class="result">
<div>
<div class="small" data-i18n="Total volume">Total volume</div>
<div><span class="v" id="dca_total_vol">‚Äî</span></div>
</div>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Total cost">Total cost</div>
<div><span class="v" id="dca_total_cost">‚Äî</span></div>
</div>
</div>
</div>
<div style="margin-top:20px;border-top:1px solid var(--border);padding-top:20px">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
<b style="color:var(--accent);font-weight:700" data-i18n="DCA Goal">DCA Goal</b>
<span class="small" data-i18n="optional">optional</span>
</div>
<div class="row">
<div class="field">
<label data-i18n="Target avg price">Target avg price</label>
<input id="dca_goal" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Next buy price">Next buy price</label>
<input id="dca_next_price" type="number" step="any" />
</div>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Needed volume at next price">Needed volume at next price</div>
<div><span class="v" id="dca_need_vol">‚Äî</span></div>
</div>
<button class="btn ghost" id="dca_need_copy" data-i18n="Copy">Copy</button>
</div>
</div>
</div>
</section>
<section id="rr" class="screen">
<div class="card">
<h3 data-i18n="Risk/Reward">Risk/Reward</h3>
<div class="row">
<div class="field">
<label data-i18n="Entry">Entry</label>
<input id="rr_entry" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Stop Loss">Stop Loss</label>
<input id="rr_sl" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Take Profit">Take Profit</label>
<input id="rr_tp" type="number" step="any" />
</div>
</div>
<div class="field">
<label data-i18n="Fee % (entry+exit)">Fee % (entry+exit)</label>
<input id="rr_fee" type="number" step="any" value="0.2" />
</div>
<div class="controls">
<button class="btn ghost" id="rr_save" data-i18n="Save">Save</button>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Gross R/R">Gross R/R</div>
<div><span class="v" id="rr_gross">‚Äî</span></div>
</div>
<button class="btn ghost" id="rr_copy_gross" data-i18n="Copy">Copy</button>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Net R/R (with fees)">Net R/R (with fees)</div>
<div><span class="v" id="rr_net">‚Äî</span></div>
</div>
<button class="btn ghost" id="rr_copy_net" data-i18n="Copy">Copy</button>
</div>
</div>
</section>
<section id="cap" class="screen">
<div class="card">
<h3 data-i18n="Capital Management">Capital Management</h3>
<div class="row">
<div class="field">
<label data-i18n="Deposit">Deposit</label>
<input id="cap_dep" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Risk %">Risk %</label>
<input id="cap_risk" type="number" step="any" value="1" />
</div>
<div class="field">
<label data-i18n="Leverage">Leverage</label>
<input id="cap_lev" type="number" step="any" value="1" />
</div>
</div>
<div class="chips">
<button class="chip" data-risk="0.5">0.5%</button>
<button class="chip active" data-risk="1">1%</button>
<button class="chip" data-risk="2">2%</button>
<button class="chip" data-risk="3">3%</button>
</div>
<div class="row">
<div class="field">
<label data-i18n="Entry">Entry</label>
<input id="cap_entry" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Stop Loss">Stop Loss</label>
<input id="cap_sl" type="number" step="any" />
</div>
<div class="field">
<label data-i18n="Fee % (entry+exit)">Fee % (entry+exit)</label>
<input id="cap_fee" type="number" step="any" value="0.2" />
</div>
</div>
<div class="controls">
<button class="btn ghost" id="cap_save" data-i18n="Save">Save</button>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Position size">Position size</div>
<div><span class="v" id="cap_pos">‚Äî</span></div>
</div>
<button class="btn ghost" id="cap_copy_pos" data-i18n="Copy">Copy</button>
</div>
<div class="row">
<div class="result">
<div>
<div class="small" data-i18n="Risk $">Risk $</div>
<div><span class="v" id="cap_risk_usd">‚Äî</span></div>
</div>
</div>
<div class="result">
<div>
<div class="small" data-i18n="Margin (with leverage)">Margin (with leverage)</div>
<div><span class="v" id="cap_margin">‚Äî</span></div>
</div>
</div>
</div>
</div>
</section>
<section id="ind" class="screen">
<div class="card">
<h3 data-i18n="Market Indicators">Market Indicators</h3>
<div class="row">
<div class="field">
<label data-i18n="Fear & Greed Index">Fear & Greed Index</label>
<div class="result">
<div><span class="v" id="fg_text">‚Äî</span></div>
</div>
</div>
<div class="field">
<label data-i18n="Market Mood">Market Mood</label>
<div class="result">
<div><span class="v" id="mood">‚Äî</span></div>
</div>
</div>
</div>
<div class="row">
<div class="field">
<label data-i18n="Total Market Cap">Total Market Cap</label>
<div class="result"><span class="v" id="tcap_text">‚Äî</span></div>
</div>
<div class="field">
<label data-i18n="Altcoin Dominance">Altcoin Dominance</label>
<div class="result"><span class="v" id="alt_text">‚Äî</span></div>
</div>
</div>
<div class="controls">
<button class="btn" id="refresh_ind" data-i18n="Refresh Data">Refresh Data</button>
<span class="small" id="ind_note"></span>
</div>
<!-- AI Tips block (Premium) -->
<div class="card" style="margin-top:16px; padding:16px;" id="ai_tips_block">
<h4 style="margin:0 0 8px 0; color:var(--accent);">ü§ñ <span data-i18n="AI Tips">AI Tips</span></h4>
<div id="ai_tip_text" style="font-size:14px; margin-bottom:12px;">‚Äî</div>
<button class="btn ghost" id="ai_refresh_btn" style="width:100%;" data-i18n="Get new tip">Get new tip</button>
<div class="small" style="margin-top:8px;" data-i18n="Premium only">(Premium only)</div>
</div>
<div class="vizgrid">
<div class="viz">
<h5 data-i18n="Fear & Greed Gauge">Fear & Greed Gauge</h5>
<canvas id="fg_canvas" width="600" height="120"></canvas>
<div style="margin-top:8px;font-weight:700;font-size:18px" id="fg_big">‚Äî</div>
<div class="small" id="fg_sub">‚Äî</div>
</div>
<div class="viz">
<h5 data-i18n="Dominance Split">Dominance Split</h5>
<canvas id="dom_canvas" width="600" height="120"></canvas>
<div style="margin-top:8px;font-weight:700;font-size:18px" id="dom_big">‚Äî</div>
<div class="small" id="dom_sub">‚Äî</div>
</div>
</div>
</div>
</section>
<div class="history">
<h4>üìú <span data-i18n="History">History</span></h4>
<div class="history-list" id="history_list"></div>
<!-- Analytics button (Premium) -->
<button class="btn ghost" id="analytics_btn" style="margin-top:12px; width:100%;" data-i18n="Trade Analytics">Trade Analytics</button>
</div>
</div>
</section>
<section id="main_premium" class="main-screen">
<div class="premium-head">
<div class="premium-title">
<div class="badge premium-badge">üíé <span data-i18n="Premium">Premium</span></div>
<h2 data-i18n="Premium Features">Premium Features</h2>
<div class="muted" id="premium_status_text">‚Äî</div>
</div>
<div class="premium-actions">
<button class="btn ghost" id="premium_back_btn">‚Üê <span data-i18n="Back to Calculator">Back to Calculator</span></button>
</div>
</div>

<!-- NEW PREMIUM PLANS STRUCTURE -->
<div class="premium-plans">
    <!-- 30 Days Plan -->
    <div class="premium-plan-card recommended">
        <div class="plan-header">
            <div class="plan-title">üéØ <span data-i18n="30 days access">Premium 30 days</span></div>
            <div class="plan-prices">
                <span class="price-tag" data-i18n="1_TON">1 TON</span>
                <span class="price-tag stars" data-i18n="89_Stars">89 Stars</span>
            </div>
        </div>
        <p class="plan-description" data-i18n="30d note">Full access to all premium features for 30 days. Perfect for testing!</p>
        <div class="plan-payment-buttons">
            <button class="payment-btn" id="pay_ton_30" data-i18n="Pay_1_TON">üíé Pay 1 TON</button>
            <button class="payment-btn stars" id="pay_stars_30" data-i18n="Pay_89_Stars">‚≠ê Pay 89 Stars</button>
        </div>
    </div>

    <!-- Lifetime Plan -->
    <div class="premium-plan-card lifetime">
        <div class="plan-header">
            <div class="plan-title">üëë <span data-i18n="Lifetime">Lifetime Access</span></div>
            <div class="plan-prices">
                <span class="price-tag" data-i18n="4_TON">4 TON</span>
                <span class="price-tag stars" data-i18n="389_Stars">389 Stars</span>
            </div>
        </div>
        <p class="plan-description" data-i18n="Lifetime note">One-time purchase. Unlimited access forever. Best value! üí∞</p>
        <div class="plan-payment-buttons">
            <button class="payment-btn lifetime" id="pay_ton_life" data-i18n="Pay_4_TON">üíé Pay 4 TON</button>
            <button class="payment-btn stars lifetime" id="pay_stars_life" data-i18n="Pay_389_Stars">‚≠ê Pay 389 Stars</button>
        </div>
    </div>
</div>

<!-- Features Section -->
<div class="premium-features">
    <h3 style="margin-bottom: 15px; font-size: 18px; color: var(--accent);">‚ú® <span data-i18n="What you get">What you get</span></h3>
    <div class="feature-item">
        <span class="feature-icon">üìä</span>
        <span><strong data-i18n="Advanced Analytics">Advanced Analytics</strong> ‚Äì deep trade statistics, charts, reports</span>
    </div>
    <div class="feature-item">
        <span class="feature-icon">ü§ñ</span>
        <span><strong data-i18n="AI Tips">AI tips</strong> ‚Äì entry/exit recommendations based on market data</span>
    </div>
    <div class="feature-item">
        <span class="feature-icon">üèÜ</span>
        <span><strong data-i18n="Secret Achievements">Secret achievements + ranks</strong> ‚Äì unique badges and levels</span>
    </div>
    <div class="feature-item">
        <span class="feature-icon">üé®</span>
        <span><strong data-i18n="Personalization">Personalization</strong> ‚Äì custom colors, fonts, widgets</span>
    </div>
    <div class="feature-item">
        <span class="feature-icon">üåà</span>
        <span><strong data-i18n="Premium Themes">Premium themes</strong> ‚Äì exclusive color schemes (Neon, Gold, Midnight)</span>
    </div>
    <div class="feature-item">
        <span class="feature-icon">‚ö°</span>
        <span><strong data-i18n="Priority Support">Priority Support</strong> ‚Äì faster responses</span>
    </div>
</div>

<!-- Themes Section -->
<div style="margin-top: 30px;">
    <h3 style="font-size: 18px; margin-bottom: 10px; color: var(--accent);">üé® <span data-i18n="Premium Themes">Premium Themes</span></h3>
    <div class="themes-grid">
        <div class="theme-card" data-premium-theme="neon" style="background: linear-gradient(135deg, #00f2ff, #00ff88);">
            <div style="color: #000; font-weight: bold;" data-i18n="Neon">Neon</div>
        </div>
        <div class="theme-card" data-premium-theme="gold" style="background: linear-gradient(135deg, #ffd700, #ffaa00);">
            <div style="color: #000; font-weight: bold;" data-i18n="Gold">Gold</div>
        </div>
        <div class="theme-card" data-premium-theme="midnight" style="background: linear-gradient(135deg, #1a1a2e, #16213e);">
            <div style="color: #fff; font-weight: bold;" data-i18n="Midnight_Pro">Midnight Pro</div>
        </div>
    </div>
    <p style="font-size: 12px; color: var(--muted); margin-top: 10px;" data-i18n="Themes note">Themes apply instantly (premium required).</p>
</div>

<div class="note" style="margin-top: 20px;" data-i18n="Payment note">Payments are processed inside Telegram. After successful payment, Premium will be activated on this device.</div>
<div class="controls" style="margin-top:12px">
    <button class="btn ghost" id="ton_check_btn" data-i18n="Check payment">‚úì Check payment</button>
</div>

</section>
<section id="main_settings" class="main-screen">
<div class="support-wrap">
<div class="card" style="max-width:600px">
<h3>‚öôÔ∏è <span data-i18n="Settings">Settings</span></h3>
<div class="card glass" style="margin-top:12px">
<h4 style="margin:0 0 10px 0">üåê <span data-i18n="Settings">Settings</span></h4>
<div class="row" style="align-items:center; gap:10px; flex-wrap:wrap">
<div class="lang" style="margin:0">
<button id="btn_ru">RU</button>
<button id="btn_en" class="active">EN</button>
</div>
<button class="iconbtn" id="theme_toggle" style="margin:0">
<span id="theme_icon">üåô</span>
<span id="theme_text">Dark</span>
</button>
</div>
<div class="small" style="margin-top:10px;color:var(--muted)" data-i18n="Settings note">
Language and theme are saved to your account.
</div>
</div>
<div class="color-picker">
<div class="color-option green active" data-color="#7CFC00"></div>
<div class="color-option blue" data-color="#2d8cff"></div>
<div class="color-option purple" data-color="#9b59b6"></div>
<div class="color-option teal" data-color="#2dd4bf"></div>
</div>
<!-- Font selector (Premium) -->
<div class="card glass" style="margin-top:16px;">
<h4 style="margin:0 0 10px 0">‚úíÔ∏è <span data-i18n="Font">Font</span> <span class="small">(Premium)</span></h4>
<div class="row">
<button class="chip" id="font_inter" data-font="inter">Inter</button>
<button class="chip" id="font_roboto" data-font="roboto">Roboto</button>
</div>
</div>
</div>
<div class="card ach-card" style="max-width:600px">
<h3>üèÜ <span data-i18n="Achievements">Achievements</span></h3>
<div class="ach-summary">
<div class="ach-progress">
<div class="small"><span data-i18n="Progress">Progress</span>: <b id="ach_progress_text">‚Äî</b></div>
<div class="ach-bar"><div id="ach_bar_fill"></div></div>
</div>
</div>
<div class="ach-list" id="ach_list"></div>
</div>
</div>
</section>
<section id="main_support" class="main-screen">
<div class="support-wrap">
<div class="card" style="max-width:600px">
<h3>üí¨ <span data-i18n="Support">Support</span></h3>
<div class="small" style="margin-bottom:16px" data-i18n="Connect your wallet for tips and donations. Contact us through the links below.">
Connect your wallet for tips and donations. Contact us through the links below.
</div>
<div class="controls">
<button class="btn" id="wallet_btn" data-i18n="Connect Wallet">Connect Wallet</button>
<button class="btn" id="tip_btn" data-i18n="Tip 0.05 TON">Tip 0.05 TON</button>
</div>
<!-- Priority support button (Premium) -->
<button class="btn ghost" id="priority_support_btn" style="margin-top:12px; width:100%;" data-i18n="Priority Support (Premium)">Priority Support (Premium)</button>
<div class="controls" style="margin-top:20px">
<button class="btn ghost" id="open_terms" data-i18n="Terms">Terms</button>
<button class="btn ghost" id="open_privacy" data-i18n="Privacy">Privacy</button>
<button class="btn ghost" id="open_support" data-i18n="Contact">Contact</button>
</div>
</div>
<div style="text-align:center">
<div style="color:var(--accent);font-weight:700;margin-bottom:12px" data-i18n="AIRDROP_NEWS_TRADING">AIRDROP ‚Ä¢ NEWS ‚Ä¢ TRADING</div>
<div class="support-links">
<a id="link_telegram" href="https://t.me/ChalovCrypto" target="_blank" data-i18n="TELEGRAM">TELEGRAM</a>
<a id="link_youtube" href="https://www.youtube.com/@ChalovCrypto" target="_blank" data-i18n="YOUTUBE">YOUTUBE</a>
</div>
</div>
</div>
</section>
</main>
<nav class="bottomnav">
<div class="bar">
<button id="main_tab_calc" class="main-tab active">
<span>üßÆ</span>
<span data-i18n="Calculator">Calculator</span>
</button>
<button id="main_tab_support" class="main-tab">
<span>üí¨</span>
<span data-i18n="Support">Support</span>
</button>
</div>
</nav>
</div>
<div id="toast">‚Äî</div>
<div id="modal_backdrop">
<div id="modal">
<div id="modal_header">
<b data-i18n="Trade Card">Trade Card</b>
<button id="modal_close">√ó</button>
</div>
<div id="modal_body">
<div id="modal_canvas_wrap">
<canvas id="card_canvas" width="600" height="200"></canvas>
</div>
<div id="modal_right">
<button class="btn" id="card_save" data-i18n="Save PNG">Save PNG</button>
<button class="btn ghost" id="card_copy" data-i18n="Copy">Copy</button>
<div id="modal_help" data-i18n="Use Save PNG for smartphones, Copy for computers">Use Save PNG for smartphones, Copy for computers</div>
</div>
</div>
</div>
</div>
<script>
(async function(){
'use strict';
const tg = window.Telegram?.WebApp || null;
if (tg) {
tg.expand();
tg.ready();
}
const API_BASE = 'https://tg-stars-premium-worker.reserv-g123.workers.dev';
const __mem = Object.create(null);
let __loaded = false;
let __saveTimer = null;
function getInitData(){
return (window.Telegram?.WebApp?.initData) || '';
}
async function fetchWithTimeout(url, options, ms){
const controller = new AbortController();
const t = setTimeout(() => controller.abort(), ms);
try{
const res = await fetch(url, { ...options, signal: controller.signal });
return res;
} finally {
clearTimeout(t);
}
}
async function loadServerStorage(){
if (__loaded) return;
const initData = getInitData();
if (!initData) { __loaded = true; return; }
try{
const r = await fetchWithTimeout(`${API_BASE}/api/user/storage`, {
method:'GET',
headers:{ 'X-Telegram-Init-Data': initData }
}, 2500);
const j = await r.json().catch(()=>null);
if (j?.ok && j.data && typeof j.data === 'object'){
Object.assign(__mem, j.data);
}
}catch(e){
console.warn('Storage load skipped:', e?.name || e);
}finally{
__loaded = true;
}
}
function scheduleSave(){
if (__saveTimer) clearTimeout(__saveTimer);
__saveTimer = setTimeout(async () => {
const initData = getInitData();
if (!initData) return;
try{
await fetch(`${API_BASE}/api/user/storage`, {
method:'POST',
headers:{ 'content-type':'application/json', 'X-Telegram-Init-Data': initData },
body: JSON.stringify(__mem)
});
}catch(e){
console.warn('Storage save failed', e);
}
}, 600);
}
const localStorage = {
getItem(k){ return Object.prototype.hasOwnProperty.call(__mem, k) ? String(__mem[k]) : null; },
setItem(k,v){ __mem[k] = String(v); scheduleSave(); },
removeItem(k){ delete __mem[k]; scheduleSave(); }
};
await loadServerStorage();
const mainCalc = document.getElementById('main_calc');
const mainPremium = document.getElementById('main_premium');
const mainSupport = document.getElementById('main_support');
const mainSettings = document.getElementById('main_settings');
const mainBtnCalc = document.getElementById('main_tab_calc');
const mainBtnSupport = document.getElementById('main_tab_support');
const premiumBtn = document.getElementById('premium_btn');
const settingsBtn = document.getElementById('settings_btn');
function setMainTab(which){
mainCalc.classList.toggle('active', which === 'calc');
mainPremium.classList.toggle('active', which === 'premium');
mainSupport.classList.toggle('active', which === 'support');
mainSettings.classList.toggle('active', which === 'settings');
mainBtnCalc.classList.toggle('active', which === 'calc');
mainBtnSupport.classList.toggle('active', which === 'support');
premiumBtn.classList.toggle('active', which === 'premium');
settingsBtn.classList.toggle('active', which === 'settings');
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('screen_view', { screen: which });
}
}
mainBtnCalc.addEventListener('click', () => setMainTab('calc'));
mainBtnSupport.addEventListener('click', () => setMainTab('support'));
premiumBtn.addEventListener('click', () => setMainTab('premium'));
settingsBtn.addEventListener('click', () => setMainTab('settings'));
const locales = {
ru: {
"Calculator": "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
"Support": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞",
"Settings": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
"Settings note": "–Ø–∑—ã–∫ –∏ —Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ.",
"Check payment": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É",
"Waiting for confirmation": "–û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
"No pending payment": "–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–µ–π –æ–ø–ª–∞—Ç—ã",
"Payment successful": "–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞",
"Cancelled": "–û—Ç–º–µ–Ω–µ–Ω–æ",
"Premium activated": "–ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω",
"Premium": "–ü—Ä–µ–º–∏—É–º",
"Premium Features": "–ü—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–∏",
"Back to Calculator": "–ù–∞–∑–∞–¥ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É",
"Plans": "–¢–∞—Ä–∏—Ñ—ã",
"30 days access": "–ü—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å –Ω–∞ 30 –¥–Ω–µ–π",
"30d note": "–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ 30 –¥–Ω–µ–π.",
"Lifetime": "–ù–∞–≤—Å–µ–≥–¥–∞",
"Lifetime note": "–†–∞–∑–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞, –±–µ–∑ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è.",
"Payment note": "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ Telegram. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –ø—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.",
"What you get": "–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ",
"Advanced Analytics": "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äì –≥–ª—É–±–æ–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–¥–µ–ª–∫–∞–º, –≥—Ä–∞—Ñ–∏–∫–∏, –æ—Ç—á—ë—Ç—ã",
"AI Tips": "AI‚Äë–ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Äì —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—Ö–æ–¥–∞–º/–≤—ã—Ö–æ–¥–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
"Secret Achievements": "–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è + —Ä–∞–Ω–≥–∏ ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–∫–∏ –∏ —É—Ä–æ–≤–Ω–∏",
"Personalization": "–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Äì –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã, –≤–∏–¥–∂–µ—Ç—ã",
"Premium Themes": "–ü—Ä–µ–º–∏—É–º‚Äë—Ç–µ–º—ã ‚Äì —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã (Neon, Gold, Midnight)",
"Priority Support": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ‚Äì –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç—ã",
"Themes note": "–¢–µ–º—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É (–Ω—É–∂–µ–Ω Premium).",
"Premium active until": "Premium –∞–∫—Ç–∏–≤–µ–Ω –¥–æ",
"Premium lifetime": "Premium –Ω–∞–≤—Å–µ–≥–¥–∞",
"Premium inactive": "Premium –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω",
"Premium required": "–ù—É–∂–µ–Ω Premium",
"Open Premium": "–û—Ç–∫—Ä—ã—Ç—å Premium",
"DCA Calculator": "DCA –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
"Add multiple entries to calculate average price, total volume and cost.": "–î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Ö–æ–¥–æ–≤ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã, –æ–±—â–µ–≥–æ –æ–±—ä—ë–º–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.",
"Add entry": "–î–æ–±–∞–≤–∏—Ç—å –≤—Ö–æ–¥",
"Clear": "–û—á–∏—Å—Ç–∏—Ç—å",
"Average price": "–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞",
"Copy": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
"Total volume": "–û–±—â–∏–π –æ–±—ä—ë–º",
"Total cost": "–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å",
"DCA Goal": "–¶–µ–ª—å DCA",
"optional": "–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ",
"Target avg price": "–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞",
"Next buy price": "–°–ª–µ–¥—É—é—â–∞—è —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏",
"Needed volume at next price": "–ù—É–∂–Ω—ã–π –æ–±—ä—ë–º –ø–æ —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–Ω–µ",
"Risk/Reward": "–†–∏—Å–∫/–î–æ—Ö–æ–¥",
"Entry": "–í—Ö–æ–¥",
"Stop Loss": "–°—Ç–æ–ø –õ–æ—Å—Å",
"Take Profit": "–¢–µ–π–∫ –ü—Ä–æ—Ñ–∏—Ç",
"Fee % (entry+exit)": "–ö–æ–º–∏—Å—Å–∏—è % (–≤—Ö–æ–¥+–≤—ã—Ö–æ–¥)",
"Gross R/R": "–ë—Ä—É—Ç—Ç–æ R/R",
"Net R/R (with fees)": "–ù–µ—Ç—Ç–æ R/R (—Å –∫–æ–º–∏—Å—Å–∏—è–º–∏)",
"Capital Management": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–∞–ø–∏—Ç–∞–ª–æ–º",
"Deposit": "–î–µ–ø–æ–∑–∏—Ç",
"Risk %": "–†–∏—Å–∫ %",
"Leverage": "–ü–ª–µ—á–æ",
"Position size": "–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏",
"Risk $": "–†–∏—Å–∫ $",
"Margin (with leverage)": "–ú–∞—Ä–∂–∞ (—Å –ø–ª–µ—á–æ–º)",
"Market Indicators": "–†—ã–Ω–æ—á–Ω—ã–µ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã",
"Fear & Greed Index": "–ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞—Ö–∞ –∏ –∂–∞–¥–Ω–æ—Å—Ç–∏",
"Market Mood": "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞",
"Total Market Cap": "–û–±—â–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è",
"Altcoin Dominance": "–î–æ–ª—è –∞–ª—å—Ç–∫–æ–∏–Ω–æ–≤",
"Refresh Data": "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
"Fear & Greed Gauge": "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä F&G",
"Dominance Split": "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–ª–∏",
"History": "–ò—Å—Ç–æ—Ä–∏—è",
"Connect your wallet for tips and donations. Contact us through the links below.": "–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫ –¥–ª—è –¥–æ–Ω–∞—Ç–æ–≤. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å—Å—ã–ª–∫–∏ –Ω–∏–∂–µ.",
"Connect Wallet": "–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫",
"Tip 0.05 TON": "–î–æ–Ω–∞—Ç 0.05 TON",
"Terms": "–£—Å–ª–æ–≤–∏—è",
"Privacy": "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",
"Contact": "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
"Share": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
"Card": "–ö–∞—Ä—Ç–æ—á–∫–∞",
"Copied!": "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
"Save PNG": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PNG",
"Dark": "–¢—ë–º–Ω–∞—è",
"Light": "–°–≤–µ—Ç–ª–∞—è",
"Color": "–¶–≤–µ—Ç",
"DCA": "DCA",
"R/R": "R/R",
"Capital": "–ö–∞–ø–∏—Ç–∞–ª",
"Indicators": "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã",
"Trade Card": "–¢–æ—Ä–≥–æ–≤–∞—è –ö–∞—Ä—Ç–æ—á–∫–∞",
"Download PNG": "–°–∫–∞—á–∞—Ç—å PNG",
"Use Save PNG for smartphones, Copy for computers": "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PNG –¥–ª—è —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤, –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤",
"Clear History": "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
"Cached data": "–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
"Loading...": "–ó–∞–≥—Ä—É–∑–∫–∞...",
"History cleared": "–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞",
"TELEGRAM": "–¢–ï–õ–ï–ì–†–ê–ú",
"YOUTUBE": "–Æ–¢–£–ë",
"Price": "–¶–µ–Ω–∞",
"Volume": "–û–±—ä—ë–º",
"Achievements": "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
"Progress": "–ü—Ä–æ–≥—Ä–µ—Å—Å",
"Reset Achievements": "–°–±—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
"Achievements saved locally": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ",
"Locked": "–ó–∞–∫—Ä—ã—Ç–æ",
"Unlocked": "–û—Ç–∫—Ä—ã—Ç–æ",
"Disconnect wallet?": "–û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫?",
"Connect wallet first": "–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫",
"Transaction sent": "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞",
"Error": "–û—à–∏–±–∫–∞",
"Image saved": "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ",
"Please allow popups to save image": "–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
"Achievement unlocked": "–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ",
"ACH_WELCOME_TITLE": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
"ACH_WELCOME_DESC": "–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–≤—ã–µ.",
"ACH_STYLE_TITLE": "–°–º–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è",
"ACH_STYLE_DESC": "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Ç–µ–º—É (—Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è).",
"ACH_COLOR_TITLE": "–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è",
"ACH_COLOR_DESC": "–°–º–µ–Ω–∏—Ç–µ –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç 3 —Ä–∞–∑–∞.",
"ACH_BILINGUAL_TITLE": "–ë–∏–ª–∏–Ω–≥–≤",
"ACH_BILINGUAL_DESC": "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.",
"ACH_DCA_TITLE": "DCA-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å",
"ACH_DCA_DESC": "–î–æ–±–∞–≤—å—Ç–µ 5 —Å—Ç—Ä–æ–∫ –≤ DCA.",
"ACH_COPY_TITLE": "–ö–æ–ø–∏–ø–∞—Å—Ç–µ—Ä",
"ACH_COPY_DESC": "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è 5 —Ä–∞–∑.",
"ACH_DATA_TITLE": "–°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ",
"ACH_DATA_DESC": "–û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä—ã–Ω–∫–∞.",
"ACH_CARD_TITLE": "–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—Ä–µ–π–¥–µ—Ä–∞",
"ACH_CARD_DESC": "–û—Ç–∫—Ä–æ–π—Ç–µ Trade Card.",
"ACH_SHARE_TITLE": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
"ACH_SHARE_DESC": "–ù–∞–∂–º–∏—Ç–µ ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª.",
"ACH_TIP_TITLE": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞",
"ACH_TIP_DESC": "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–æ–Ω–∞—Ç 0.05 TON.",
"ACH_HISTORY_TITLE": "–õ–µ—Ç–æ–ø–∏—Å–µ—Ü",
"ACH_HISTORY_DESC": "–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ 10 –¥–µ–π—Å—Ç–≤–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏.",
"ACH_PREMIUM_TITLE": "–ê–ª–º–∞–∑–Ω—ã–π —Å—Ç–∞—Ç—É—Å",
"ACH_PREMIUM_DESC": "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å Premium.",
"ACH_THEME_TITLE": "–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å —Ç–µ–º",
"ACH_THEME_DESC": "–ü—Ä–∏–º–µ–Ω–∏—Ç—å 3 –ø—Ä–µ–º–∏—É–º —Ç–µ–º—ã.",
"ACH_ANALYTICS_TITLE": "–ê–Ω–∞–ª–∏—Ç–∏–∫",
"ACH_ANALYTICS_DESC": "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Premium).",
"1_TON": "1 TON",
"89_Stars": "89 Stars",
"4_TON": "4 TON",
"389_Stars": "389 Stars",
"Pay_1_TON": "–û–ø–ª–∞—Ç–∏—Ç—å 1 TON",
"Pay_89_Stars": "–û–ø–ª–∞—Ç–∏—Ç—å 89 Stars",
"Pay_4_TON": "–û–ø–ª–∞—Ç–∏—Ç—å 4 TON",
"Pay_389_Stars": "–û–ø–ª–∞—Ç–∏—Ç—å 389 Stars",
"Neon": "–ù–µ–æ–Ω",
"Gold": "–ó–æ–ª–æ—Ç–æ",
"Midnight_Pro": "–ü–æ–ª—É–Ω–æ—á–Ω—ã–π –ü—Ä–æ",
"AIRDROP_NEWS_TRADING": "–≠–ô–†–î–†–û–ü ‚Ä¢ –ù–û–í–û–°–¢–ò ‚Ä¢ –¢–†–ï–ô–î–ò–ù–ì",
"Save": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
"Saved to history": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ç–æ—Ä–∏—é",
"Connect wallet in the support tab": "–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫ –≤–æ –≤–∫–ª–∞–¥–∫–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
"Get new tip": "–ù–æ–≤—ã–π —Å–æ–≤–µ—Ç",
"Premium only": "–¢–æ–ª—å–∫–æ Premium",
"Trade Analytics": "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫",
"Priority Support (Premium)": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (Premium)",
"Font": "–®—Ä–∏—Ñ—Ç"
},
en: {
"Calculator": "Calculator",
"Support": "Support",
"Settings": "Settings",
"Settings note": "Language and theme are saved to your account.",
"Check payment": "Check payment",
"Waiting for confirmation": "Waiting for confirmation",
"No pending payment": "No pending payment",
"Payment successful": "Payment successful",
"Cancelled": "Cancelled",
"Premium activated": "Premium activated",
"Premium": "Premium",
"Premium Features": "Premium Features",
"Back to Calculator": "Back to Calculator",
"Plans": "Plans",
"30 days access": "Premium status for 30 days",
"30d note": "Unlock all premium features for 30 days.",
"Lifetime": "Lifetime",
"Lifetime note": "One-time purchase, no expiration.",
"Payment note": "Payments are processed inside Telegram. After successful payment, Premium will be activated on this device.",
"What you get": "What you get",
"Advanced Analytics": "Advanced Analytics ‚Äì deep trade statistics, charts, reports",
"AI Tips": "AI tips ‚Äì entry/exit recommendations based on market data",
"Secret Achievements": "Secret achievements + ranks ‚Äì unique badges and levels",
"Personalization": "Personalization ‚Äì custom colors, fonts, widgets",
"Premium Themes": "Premium themes ‚Äì exclusive color schemes (Neon, Gold, Midnight)",
"Priority Support": "Priority Support ‚Äì faster responses",
"Themes note": "Themes apply instantly (premium required).",
"Premium active until": "Premium active until",
"Premium lifetime": "Premium lifetime",
"Premium inactive": "Premium inactive",
"Premium required": "Premium required",
"Open Premium": "Open Premium",
"DCA Calculator": "DCA Calculator",
"Add multiple entries to calculate average price, total volume and cost.": "Add multiple entries to calculate average price, total volume and cost.",
"Add entry": "Add entry",
"Clear": "Clear",
"Average price": "Average price",
"Copy": "Copy",
"Total volume": "Total volume",
"Total cost": "Total cost",
"DCA Goal": "DCA Goal",
"optional": "optional",
"Target avg price": "Target avg price",
"Next buy price": "Next buy price",
"Needed volume at next price": "Needed volume at next price",
"Risk/Reward": "Risk/Reward",
"Entry": "Entry",
"Stop Loss": "Stop Loss",
"Take Profit": "Take Profit",
"Fee % (entry+exit)": "Fee % (entry+exit)",
"Gross R/R": "Gross R/R",
"Net R/R (with fees)": "Net R/R (with fees)",
"Capital Management": "Capital Management",
"Deposit": "Deposit",
"Risk %": "Risk %",
"Leverage": "Leverage",
"Position size": "Position size",
"Risk $": "Risk $",
"Margin (with leverage)": "Margin (with leverage)",
"Market Indicators": "Market Indicators",
"Fear & Greed Index": "Fear & Greed Index",
"Market Mood": "Market Mood",
"Total Market Cap": "Total Market Cap",
"Altcoin Dominance": "Altcoin Dominance",
"Refresh Data": "Refresh Data",
"Fear & Greed Gauge": "Fear & Greed Gauge",
"Dominance Split": "Dominance Split",
"History": "History",
"Connect your wallet for tips and donations. Contact us through the links below.": "Connect your wallet for tips and donations. Contact us through the links below.",
"Connect Wallet": "Connect Wallet",
"Tip 0.05 TON": "Tip 0.05 TON",
"Terms": "Terms",
"Privacy": "Privacy",
"Contact": "Contact",
"Share": "Share",
"Card": "Card",
"Copied!": "Copied!",
"Save PNG": "Save PNG",
"Dark": "Dark",
"Light": "Light",
"Color": "Color",
"DCA": "DCA",
"R/R": "R/R",
"Capital": "Capital",
"Indicators": "Indicators",
"Trade Card": "Trade Card",
"Download PNG": "Download PNG",
"Use Save PNG for smartphones, Copy for computers": "Use Save PNG for smartphones, Copy for computers",
"Clear History": "Clear History",
"Cached data": "Cached data",
"Loading...": "Loading...",
"History cleared": "History cleared",
"TELEGRAM": "TELEGRAM",
"YOUTUBE": "YOUTUBE",
"Price": "Price",
"Volume": "Volume",
"Achievements": "Achievements",
"Progress": "Progress",
"Reset Achievements": "Reset achievements",
"Achievements saved locally": "Saved locally in your browser",
"Locked": "Locked",
"Unlocked": "Unlocked",
"Disconnect wallet?": "Disconnect wallet?",
"Connect wallet first": "Connect wallet first",
"Transaction sent": "Transaction sent",
"Error": "Error",
"Image saved": "Image saved",
"Please allow popups to save image": "Please allow popups to save image",
"Achievement unlocked": "Achievement unlocked",
"ACH_WELCOME_TITLE": "Welcome",
"ACH_WELCOME_DESC": "Open the app for the first time.",
"ACH_STYLE_TITLE": "Style switcher",
"ACH_STYLE_DESC": "Toggle the theme (dark/light).",
"ACH_COLOR_TITLE": "Customization",
"ACH_COLOR_DESC": "Change the accent color 3 times.",
"ACH_BILINGUAL_TITLE": "Bilingual",
"ACH_BILINGUAL_DESC": "Switch the app language.",
"ACH_DCA_TITLE": "DCA builder",
"ACH_DCA_DESC": "Add 5 rows in DCA.",
"ACH_COPY_TITLE": "Copy machine",
"ACH_COPY_DESC": "Copy values 5 times.",
"ACH_DATA_TITLE": "Fresh data",
"ACH_DATA_DESC": "Refresh market indicators.",
"ACH_CARD_TITLE": "Trader card",
"ACH_CARD_DESC": "Open the Trade Card.",
"ACH_SHARE_TITLE": "Share it",
"ACH_SHARE_DESC": "Tap the Share button.",
"ACH_TIP_TITLE": "Supporter",
"ACH_TIP_DESC": "Send a 0.05 TON tip.",
"ACH_HISTORY_TITLE": "Historian",
"ACH_HISTORY_DESC": "Save 10 actions to history.",
"ACH_PREMIUM_TITLE": "Diamond status",
"ACH_PREMIUM_DESC": "Activate Premium.",
"ACH_THEME_TITLE": "Theme master",
"ACH_THEME_DESC": "Apply 3 premium themes.",
"ACH_ANALYTICS_TITLE": "Analyst",
"ACH_ANALYTICS_DESC": "View advanced analytics (Premium).",
"1_TON": "1 TON",
"89_Stars": "89 Stars",
"4_TON": "4 TON",
"389_Stars": "389 Stars",
"Pay_1_TON": "Pay 1 TON",
"Pay_89_Stars": "Pay 89 Stars",
"Pay_4_TON": "Pay 4 TON",
"Pay_389_Stars": "Pay 389 Stars",
"Neon": "Neon",
"Gold": "Gold",
"Midnight_Pro": "Midnight Pro",
"AIRDROP_NEWS_TRADING": "AIRDROP ‚Ä¢ NEWS ‚Ä¢ TRADING",
"Save": "Save",
"Saved to history": "Saved to history",
"Connect wallet in the support tab": "Connect wallet in the support tab",
"Get new tip": "Get new tip",
"Premium only": "Premium only",
"Trade Analytics": "Trade Analytics",
"Priority Support (Premium)": "Priority Support (Premium)",
"Font": "Font"
}
};
let lang = 'en';
try {
const tgl = tg?.initDataUnsafe?.user?.language_code;
if (tgl && tgl.startsWith('ru')) lang = 'ru';
} catch(e) {}
function t(key) {
const locale = locales[lang] || locales.en;
return locale[key] || key;
}
function translateAll() {
document.querySelectorAll('[data-i18n]').forEach(el => {
const key = el.getAttribute('data-i18n');
const translation = t(key);
if (el.tagName === 'INPUT') {
el.placeholder = translation;
} else {
el.textContent = translation;
}
});
document.getElementById('main_tab_calc').querySelector('span:last-child').textContent = t('Calculator');
document.getElementById('main_tab_support').querySelector('span:last-child').textContent = t('Support');
document.querySelector('.history h4').querySelector('span').textContent = t('History');
dcaRows.forEach(row => {
row.pEl.placeholder = t('Price');
row.vEl.placeholder = t('Volume');
});
}
let toastTimer = null;
function showToast(msg) {
const el = document.getElementById('toast');
el.textContent = msg;
el.classList.add('show');
clearTimeout(toastTimer);
toastTimer = setTimeout(() => el.classList.remove('show'), 2000);
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('toast_shown', { message: msg.substring(0, 50) });
}
}
const PREMIUM_KEY = 'tc_premium_v1';
function loadPremium(){
try{
const raw = localStorage.getItem(PREMIUM_KEY);
if(!raw) return { lifetime:false, expiresAt:0, plan:'', tx:'' };
const obj = JSON.parse(raw);
return Object.assign({ lifetime:false, expiresAt:0, plan:'', tx:'' }, obj);
}catch(e){
return { lifetime:false, expiresAt:0, plan:'', tx:'' };
}
}
function savePremium(p){ localStorage.setItem(PREMIUM_KEY, JSON.stringify(p)); }
function isPremiumActive(p){
return !!p && (p.lifetime || (p.expiresAt && Date.now() < p.expiresAt));
}
function premiumStatusText(){
const p = loadPremium();
if (p.lifetime) return t('Premium lifetime');
if (p.expiresAt && Date.now() < p.expiresAt) {
const d = new Date(p.expiresAt);
return `${t('Premium active until')} ${d.toLocaleString()}`;
}
return t('Premium inactive');
}
function renderPremiumStatus(){
const el = document.getElementById('premium_status_text');
if (el) el.textContent = premiumStatusText();
}
async function refreshPremiumStatus() {
const initData = getInitData();
if (!initData) return;
try {
const res = await fetch(`${API_BASE}/api/premium/status`, {
headers: { 'X-Telegram-Init-Data': initData }
});
const data = await res.json();
if (data.ok) {
const p = {
lifetime: data.lifetime,
expiresAt: data.expiresAt || 0,
plan: '',
tx: ''
};
savePremium(p);
renderPremiumStatus();
}
} catch (e) {
console.warn('Failed to refresh premium status', e);
}
}
function activatePremiumDays(days, plan, tx){
const p = loadPremium();
const now = Date.now();
p.lifetime = false;
p.expiresAt = now + days * 86400000;
p.plan = plan || `days_${days}`;
p.tx = tx || '';
savePremium(p);
renderPremiumStatus();
try{ onAchievementEvent('premium_user'); }catch(e){}
showToast(t('Premium activated'));
}
function activatePremiumLifetime(plan, tx){
const p = loadPremium();
p.lifetime = true;
p.expiresAt = 0;
p.plan = plan || 'lifetime';
p.tx = tx || '';
savePremium(p);
renderPremiumStatus();
try{ onAchievementEvent('premium_user'); }catch(e){}
showToast(t('Premium activated'));
}
function resetPremium(){
localStorage.removeItem(PREMIUM_KEY);
renderPremiumStatus();
showToast(t('Premium inactive'));
}
function requirePremium(reason){
const p = loadPremium();
if (isPremiumActive(p)) return true;
showToast(`${t('Premium required')} ‚Ä¢ ${reason || ''}`.trim());
setMainTab('premium');
return false;
}
const ACH_KEY = 'tc_achievements_v1';
function loadAchState() {
try {
const raw = localStorage.getItem(ACH_KEY);
if (!raw) return { unlocked: {}, counters: {} };
const j = JSON.parse(raw);
return { unlocked: j?.unlocked || {}, counters: j?.counters || {} };
} catch(e) {
return { unlocked: {}, counters: {} };
}
}
function saveAchState(state) {
try { localStorage.setItem(ACH_KEY, JSON.stringify(state)); } catch(e) {}
}
const achievements = [
{ id: 'first_launch', icon: '‚ú®', titleKey: 'ACH_WELCOME_TITLE', descKey: 'ACH_WELCOME_DESC', type: 'one' },
{ id: 'theme_switch', icon: 'üåì', titleKey: 'ACH_STYLE_TITLE', descKey: 'ACH_STYLE_DESC', type: 'one' },
{ id: 'color_3', icon: 'üé®', titleKey: 'ACH_COLOR_TITLE', descKey: 'ACH_COLOR_DESC', type: 'count', counter: 'color_changes', need: 3 },
{ id: 'lang_switch', icon: 'üåç', titleKey: 'ACH_BILINGUAL_TITLE', descKey: 'ACH_BILINGUAL_DESC', type: 'one' },
{ id: 'dca_5', icon: 'üß±', titleKey: 'ACH_DCA_TITLE', descKey: 'ACH_DCA_DESC', type: 'count', counter: 'dca_adds', need: 5 },
{ id: 'copy_5', icon: 'üìã', titleKey: 'ACH_COPY_TITLE', descKey: 'ACH_COPY_DESC', type: 'count', counter: 'copies', need: 5 },
{ id: 'ind_refresh', icon: 'üõ∞Ô∏è', titleKey: 'ACH_DATA_TITLE', descKey: 'ACH_DATA_DESC', type: 'one' },
{ id: 'card_open', icon: 'üÉè', titleKey: 'ACH_CARD_TITLE', descKey: 'ACH_CARD_DESC', type: 'one' },
{ id: 'share', icon: 'üì§', titleKey: 'ACH_SHARE_TITLE', descKey: 'ACH_SHARE_DESC', type: 'one' },
{ id: 'tip', icon: 'üíé', titleKey: 'ACH_TIP_TITLE', descKey: 'ACH_TIP_DESC', type: 'one' },
{ id: 'history_10', icon: 'üìú', titleKey: 'ACH_HISTORY_TITLE', descKey: 'ACH_HISTORY_DESC', type: 'count', counter: 'history_saved', need: 10 },
{ id: 'premium_user', icon: 'üíé', titleKey: 'ACH_PREMIUM_TITLE', descKey: 'ACH_PREMIUM_DESC', type: 'one', premium: true },
{ id: 'theme_master', icon: 'üåà', titleKey: 'ACH_THEME_TITLE', descKey: 'ACH_THEME_DESC', type: 'count', counter: 'premium_themes', need: 3, premium: true },
{ id: 'analytics_view', icon: 'üìä', titleKey: 'ACH_ANALYTICS_TITLE', descKey: 'ACH_ANALYTICS_DESC', type: 'one', premium: true }
];
let achState = loadAchState();
function isUnlocked(id) { return !!achState.unlocked[id]; }
function unlockAchievement(id) {
if (isUnlocked(id)) return false;
achState.unlocked[id] = Date.now();
saveAchState(achState);
renderAchievements();
const a = achievements.find(x => x.id === id);
showToast(`${t('Achievement unlocked')}: ${t(a?.titleKey || id)}`);
if (window.TelegramAnalytics) window.TelegramAnalytics.trackEvent('achievement_unlocked', { id });
return true;
}
function incCounter(name, by = 1) {
achState.counters[name] = (Number(achState.counters[name]) || 0) + by;
saveAchState(achState);
}
function checkCounters() {
achievements.forEach(a => {
if (a.type !== 'count') return;
const v = Number(achState.counters[a.counter]) || 0;
if (v >= a.need) unlockAchievement(a.id);
});
}
function onAchievementEvent(evt) {
if (evt === 'color_changed') incCounter('color_changes', 1);
if (evt === 'dca_add') incCounter('dca_adds', 1);
if (evt === 'value_copied') incCounter('copies', 1);
if (evt === 'history_saved') incCounter('history_saved', 1);
if (evt === 'theme_changed') unlockAchievement('theme_switch');
if (evt === 'language_changed') unlockAchievement('lang_switch');
if (evt === 'indicators_fetched') unlockAchievement('ind_refresh');
if (evt === 'card_opened') unlockAchievement('card_open');
if (evt === 'shared') unlockAchievement('share');
if (evt === 'tip_sent') unlockAchievement('tip');
if (evt === 'premium_user') unlockAchievement('premium_user');
if (evt === 'premium_theme_applied') incCounter('premium_themes', 1);
if (evt === 'analytics_view') unlockAchievement('analytics_view');
checkCounters();
}
function renderAchievements() {
const list = document.getElementById('ach_list');
const progressText = document.getElementById('ach_progress_text');
const barFill = document.getElementById('ach_bar_fill');
if (!list || !progressText || !barFill) return;
const total = achievements.length;
const unlocked = achievements.filter(a => isUnlocked(a.id)).length;
const pActive = isPremiumActive(loadPremium());
progressText.textContent = `${unlocked}/${total}`;
barFill.style.width = total ? `${Math.round((unlocked / total) * 100)}%` : '0%';
list.innerHTML = '';
achievements.forEach(a => {
const premiumLocked = !!a.premium && !pActive;
const unlockedAt = premiumLocked ? null : (achState.unlocked[a.id] || null);
const node = document.createElement('div');
node.className = premiumLocked ? 'ach-item locked' : 'ach-item';
const pillClass = unlockedAt ? 'ach-pill unlocked' : 'ach-pill';
const pillText = unlockedAt ? t('Unlocked') : (premiumLocked ? 'üîí Premium' : t('Locked'));
let extra = '';
if (a.type === 'count') {
const v = Number(achState.counters[a.counter]) || 0;
extra = ` ‚Ä¢ ${Math.min(v, a.need)}/${a.need}`;
}
node.innerHTML = `
<div class="ach-ico">${a.icon}</div>
<div class="ach-main">
<div class="ach-title">${t(a.titleKey)}${a.type === 'count' ? `<span class="small">${extra}</span>` : ''}</div>
<div class="ach-desc">${t(a.descKey)}</div>
</div>
<div class="${pillClass}">${pillText}</div>
`;
list.appendChild(node);
});
}
function resetAchievements() {
achState = { unlocked: {}, counters: {} };
saveAchState(achState);
renderAchievements();
}
const THEME_KEY = 'tc_theme';
function getInitialTheme() {
const saved = localStorage.getItem(THEME_KEY);
if (saved === 'dark' || saved === 'light') return saved;
const tgScheme = (tg?.colorScheme || '').toLowerCase();
return tgScheme === 'light' ? 'light' : 'dark';
}
function setTheme(theme) {
document.documentElement.setAttribute('data-theme', theme);
localStorage.setItem(THEME_KEY, theme);
document.getElementById('theme_icon').textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
document.getElementById('theme_text').textContent = t(theme === 'light' ? 'Light' : 'Dark');
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('theme_changed', { theme: theme });
}
onAchievementEvent('theme_changed');
}
setTheme(getInitialTheme());
document.getElementById('theme_toggle').addEventListener('click', () => {
const current = document.documentElement.getAttribute('data-theme');
setTheme(current === 'dark' ? 'light' : 'dark');
});
const COLOR_KEY = 'tc_accent_color';
const colorOptions = document.querySelectorAll('.color-option');
function setAccentColor(color) {
document.documentElement.style.setProperty('--accent', color);
localStorage.setItem(COLOR_KEY, color);
colorOptions.forEach(option => {
option.classList.toggle('active', option.dataset.color === color);
});
const pulseColor = color === '#7CFC00' ? '#7CFC00' :
color === '#2d8cff' ? '#2d8cff' :
color === '#9b59b6' ? '#9b59b6' :
color === '#ffa500' ? '#ffa500' :
color === '#ff6b9d' ? '#ff6b9d' :
color === '#2dd4bf' ? '#2dd4bf' :
color === '#fbbf24' ? '#fbbf24' :
'#ef4444';
document.documentElement.style.setProperty('--pulse-color', pulseColor);
try {
const c = pulseColor.replace('#','');
const r = parseInt(c.substring(0,2),16);
const g = parseInt(c.substring(2,4),16);
const b = parseInt(c.substring(4,6),16);
if (isFinite(r) && isFinite(g) && isFinite(b)) {
document.documentElement.style.setProperty('--accent-rgb', `${r}, ${g}, ${b}`);
}
} catch(e) {}
onAchievementEvent('color_changed');
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('color_changed', { color: color });
}
}
const savedColor = localStorage.getItem(COLOR_KEY) || '#7CFC00';
setAccentColor(savedColor);
colorOptions.forEach(option => {
option.addEventListener('click', () => {
setAccentColor(option.dataset.color);
});
});
function safeNum(v) {
const x = parseFloat(v);
return isFinite(x) ? x : 0;
}
function fmt(v, digits = 8) {
if (v === null || v === undefined || !isFinite(v)) return '‚Äî';
const n = Number(v);
const abs = Math.abs(n);
const d = abs >= 1000 ? 2 : (abs >= 1 ? 6 : digits);
return n.toLocaleString(undefined, {maximumFractionDigits: d});
}
const btnRu = document.getElementById('btn_ru');
const btnEn = document.getElementById('btn_en');
function syncLangButtons() {
btnRu.classList.toggle('active', lang === 'ru');
btnEn.classList.toggle('active', lang === 'en');
}
syncLangButtons();
btnRu.addEventListener('click', () => {
lang = 'ru';
syncLangButtons();
translateAll();
renderAchievements();
renderHistory();
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('language_changed', { language: 'ru' });
}
onAchievementEvent('language_changed');
});
btnEn.addEventListener('click', () => {
lang = 'en';
syncLangButtons();
translateAll();
renderAchievements();
renderHistory();
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('language_changed', { language: 'en' });
}
onAchievementEvent('language_changed');
});
document.querySelectorAll('.subtab').forEach(btn => {
btn.addEventListener('click', () => {
document.querySelectorAll('.subtab').forEach(t => t.classList.remove('active'));
btn.classList.add('active');
const target = btn.dataset.tab;
document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
document.getElementById(target).classList.add('active');
if (target === 'ind' && !lastIndicators) fetchIndicators();
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('tab_switched', { tab: target });
}
});
});
function activeTab() {
const act = document.querySelector('.subtab.active');
return act?.dataset?.tab || 'dca';
}
const dcaRowsEl = document.getElementById('dca_rows');
const dcaAvgEl = document.getElementById('dca_avg');
const dcaTotalVolEl = document.getElementById('dca_total_vol');
const dcaTotalCostEl = document.getElementById('dca_total_cost');
const dcaGoal = document.getElementById('dca_goal');
const dcaNext = document.getElementById('dca_next_price');
const dcaNeedVol = document.getElementById('dca_need_vol');
let dcaRows = [];
function addDcaRow(p = 0, v = 0) {
const rowId = Date.now() + Math.random();
const wrap = document.createElement('div');
wrap.className = 'row';
wrap.style.marginBottom = '8px';
wrap.innerHTML = `
<div class="field" style="flex:2">
<input type="number" step="any" placeholder="${t('Price')}" value="${p || ''}">
</div>
<div class="field" style="flex:2">
<input type="number" step="any" placeholder="${t('Volume')}" value="${v || ''}">
</div>
<div class="field" style="flex:1">
<button class="btn ghost" type="button" style="width:100%">√ó</button>
</div>
`;
const inputs = wrap.querySelectorAll('input');
const btnRemove = wrap.querySelector('button');
const item = { id: rowId, el: wrap, pEl: inputs[0], vEl: inputs[1] };
inputs.forEach(inp => inp.addEventListener('input', () => {
calcDCA();
}));
btnRemove.addEventListener('click', () => {
dcaRows = dcaRows.filter(r => r.id !== rowId);
wrap.remove();
calcDCA();
});
dcaRows.push(item);
dcaRowsEl.appendChild(wrap);
calcDCA();
}
function clearDCA() {
dcaRows = [];
dcaRowsEl.innerHTML = '';
addDcaRow();
addDcaRow();
dcaGoal.value = '';
dcaNext.value = '';
calcDCA();
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('dca_cleared');
}
}
function calcDCA() {
let totalVol = 0;
let totalCost = 0;
dcaRows.forEach(r => {
const p = safeNum(r.pEl.value);
const v = safeNum(r.vEl.value);
if (p > 0 && v > 0) {
totalVol += v;
totalCost += p * v;
}
});
if (totalVol <= 0) {
dcaAvgEl.textContent = '‚Äî';
dcaTotalVolEl.textContent = '‚Äî';
dcaTotalCostEl.textContent = '‚Äî';
dcaNeedVol.textContent = '‚Äî';
return { avg: null, totalVol: 0, totalCost: 0 };
}
const avg = totalCost / totalVol;
dcaAvgEl.textContent = fmt(avg, 10);
dcaTotalVolEl.textContent = fmt(totalVol, 8);
dcaTotalCostEl.textContent = fmt(totalCost, 2);
const target = safeNum(dcaGoal.value);
const nextP = safeNum(dcaNext.value);
if (target > 0 && nextP > 0 && nextP !== target) {
const x = (target * totalVol - totalCost) / (nextP - target);
dcaNeedVol.textContent = (isFinite(x) && x > 0) ? fmt(x, 8) : '‚Äî';
} else {
dcaNeedVol.textContent = '‚Äî';
}
if (window.TelegramAnalytics && totalVol > 0) {
window.TelegramAnalytics.trackEvent('calculator_used', {
type: 'DCA',
entries: dcaRows.length,
totalVol: totalVol
});
}
return { avg, totalVol, totalCost };
}
document.getElementById('dca_add').addEventListener('click', () => {
addDcaRow();
onAchievementEvent('dca_add');
});
document.getElementById('dca_clear').addEventListener('click', clearDCA);
dcaGoal.addEventListener('input', calcDCA);
dcaNext.addEventListener('input', calcDCA);
function saveCalculationToHistory(type, summary) {
const arr = loadHistory();
arr.unshift({
t: Date.now(),
type: type,
summary: summary
});
if (arr.length > 50) arr.length = 50;
saveHistory(arr);
renderHistory();
onAchievementEvent('history_saved');
showToast(t('Saved to history'));
}
document.getElementById('dca_save').addEventListener('click', () => {
const summary = `DCA: Avg ${dcaAvgEl.textContent}, Vol ${dcaTotalVolEl.textContent}, Cost ${dcaTotalCostEl.textContent}`;
saveCalculationToHistory('DCA', summary);
});
document.getElementById('rr_save').addEventListener('click', () => {
const summary = `R/R: Gross ${rrGross.textContent}, Net ${rrNet.textContent} (Entry: ${rrEntry.value}, SL: ${rrSl.value}, TP: ${rrTp.value}, Fee: ${rrFee.value}%)`;
saveCalculationToHistory('R/R', summary);
});
document.getElementById('cap_save').addEventListener('click', () => {
const summary = `Capital: Pos ${capPos.textContent}, Risk $${capRiskUsd.textContent}, Margin $${capMargin.textContent}`;
saveCalculationToHistory('Capital', summary);
});
async function copyText(text) {
if (!text || text === '‚Äî') return false;
try {
await navigator.clipboard.writeText(String(text));
return true;
} catch (e) {
return false;
}
}
function getHistoryType(tab) {
const map = {
'dca': 'DCA',
'rr': 'R/R',
'cap': 'Capital',
'ind': 'Indicators'
};
return map[tab] || tab;
}
function bindCopy(btn, getVal, getSummary = null) {
btn.addEventListener('click', async () => {
const val = getVal();
const ok = await copyText(val);
if (ok) {
showToast(t('Copied!'));
onAchievementEvent('value_copied');
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('value_copied', {
value: val.substring(0, 30)
});
}
}
});
}
bindCopy(document.getElementById('dca_copy'), () => dcaAvgEl.textContent);
bindCopy(document.getElementById('dca_need_copy'), () => dcaNeedVol.textContent);
const rrEntry = document.getElementById('rr_entry');
const rrSl = document.getElementById('rr_sl');
const rrTp = document.getElementById('rr_tp');
const rrFee = document.getElementById('rr_fee');
const rrGross = document.getElementById('rr_gross');
const rrNet = document.getElementById('rr_net');
function calcRR() {
const e = safeNum(rrEntry.value);
const sl = safeNum(rrSl.value);
const tp = safeNum(rrTp.value);
const fee = safeNum(rrFee.value) / 100;
if (!e || !sl || !tp || e === sl) {
rrGross.textContent = '‚Äî';
rrNet.textContent = '‚Äî';
return { gross: null, net: null };
}
const risk = Math.abs(e - sl);
const reward = Math.abs(tp - e);
if (!risk || !reward) {
rrGross.textContent = '‚Äî';
rrNet.textContent = '‚Äî';
return { gross: null, net: null };
}
const gross = (reward / risk);
rrGross.textContent = '1:' + gross.toFixed(2);
const feeEntry = e * fee;
const feeExit = tp * fee;
const netReward = Math.max(0, reward - (feeEntry + feeExit));
const net = (netReward / (risk + feeEntry));
rrNet.textContent = '1:' + net.toFixed(2);
if (window.TelegramAnalytics && e > 0) {
window.TelegramAnalytics.trackEvent('calculator_used', {
type: 'R/R',
gross: gross,
net: net
});
}
return { gross, net };
}
[rrEntry, rrSl, rrTp, rrFee].forEach(x => x.addEventListener('input', calcRR));
bindCopy(document.getElementById('rr_copy_gross'), () => rrGross.textContent);
bindCopy(document.getElementById('rr_copy_net'), () => rrNet.textContent);
const capDep = document.getElementById('cap_dep');
const capRisk = document.getElementById('cap_risk');
const capLev = document.getElementById('cap_lev');
const capEntry = document.getElementById('cap_entry');
const capSl = document.getElementById('cap_sl');
const capFee = document.getElementById('cap_fee');
const capPos = document.getElementById('cap_pos');
const capRiskUsd = document.getElementById('cap_risk_usd');
const capMargin = document.getElementById('cap_margin');
document.querySelectorAll('.chip[data-risk]').forEach(ch => {
ch.addEventListener('click', () => {
document.querySelectorAll('.chip[data-risk]').forEach(x => x.classList.remove('active'));
ch.classList.add('active');
capRisk.value = ch.dataset.risk;
calcCap();
});
});
function calcCap() {
const dep = safeNum(capDep.value);
const rp = safeNum(capRisk.value) / 100;
const lev = Math.max(1, safeNum(capLev.value) || 1);
const e = safeNum(capEntry.value);
const sl = safeNum(capSl.value);
const fee = safeNum(capFee.value) / 100;
if (dep <= 0 || rp <= 0 || e <= 0 || sl <= 0 || e === sl) {
capPos.textContent = '‚Äî';
capRiskUsd.textContent = '‚Äî';
capMargin.textContent = '‚Äî';
return { pos: null };
}
const riskUsd = dep * rp;
const move = Math.abs(e - sl) + (e * fee);
const pos = riskUsd / move;
capPos.textContent = fmt(pos, 8);
capRiskUsd.textContent = fmt(riskUsd, 2);
const notional = pos * e;
capMargin.textContent = fmt(notional / lev, 2);
if (window.TelegramAnalytics && dep > 0) {
window.TelegramAnalytics.trackEvent('calculator_used', {
type: 'Capital',
positionSize: pos,
riskUsd: riskUsd
});
}
return { pos };
}
[capDep, capRisk, capLev, capEntry, capSl, capFee].forEach(x => x.addEventListener('input', calcCap));
bindCopy(document.getElementById('cap_copy_pos'), () => capPos.textContent);
const fgText = document.getElementById('fg_text');
const tcapText = document.getElementById('tcap_text');
const altText = document.getElementById('alt_text');
const moodEl = document.getElementById('mood');
const indNote = document.getElementById('ind_note');
let lastIndicators = null;
const IND_CACHE_KEY = 'tc_ind_cache';
function saveIndicatorsCache(data) {
try {
localStorage.setItem(IND_CACHE_KEY, JSON.stringify({ t: Date.now(), data }));
} catch(e) {}
}
function loadIndicatorsCache() {
try {
const raw = localStorage.getItem(IND_CACHE_KEY);
if (!raw) return null;
const j = JSON.parse(raw);
return j;
} catch(e) {
return null;
}
}
function computeMood(fgValue) {
if (!isFinite(fgValue)) return '‚Äî';
if (fgValue >= 70) return lang === 'ru' ? '–ñ–∞–¥–Ω–æ—Å—Ç—å' : 'Greed';
if (fgValue <= 30) return lang === 'ru' ? '–°—Ç—Ä–∞—Ö' : 'Fear';
return lang === 'ru' ? '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ' : 'Neutral';
}
async function fetchIndicators() {
indNote.textContent = t('Loading...');
let fgVal = null, fgClass = '‚Äî', totalMc = null, btcDom = null;
try {
const res = await fetch('https://api.alternative.me/fng/?limit=1&format=json');
if (res.ok) {
const j = await res.json();
const d = j?.data?.[0];
fgVal = d ? Number(d.value) : null;
fgClass = d?.value_classification || '‚Äî';
}
} catch(e) {}
try {
const res2 = await fetch('https://api.coingecko.com/api/v3/global');
if (res2.ok) {
const j2 = await res2.json();
totalMc = j2?.data?.total_market_cap?.usd ?? null;
btcDom = j2?.data?.market_cap_percentage?.btc ?? null;
}
} catch(e) {}
fgText.textContent = isFinite(fgVal) ? `${fgVal} ¬∑ ${fgClass}` : '‚Äî';
tcapText.textContent = isFinite(totalMc) ? '$' + Number(totalMc).toLocaleString() : '‚Äî';
let altDom = null;
if (typeof btcDom === 'number' && isFinite(btcDom)) {
altDom = 100 - btcDom;
altText.textContent = altDom.toFixed(2) + '%';
} else {
altText.textContent = '‚Äî';
}
moodEl.textContent = computeMood(fgVal);
lastIndicators = { fgVal, fgClass, totalMc, btcDom, altDom };
saveIndicatorsCache(lastIndicators);
drawAllIndicatorVisuals(lastIndicators);
indNote.textContent = '';
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('indicators_fetched', {
fgIndex: fgVal
});
}
onAchievementEvent('indicators_fetched');
}
function drawGauge(canvas, value) {
if (!canvas) return;
const ctx = canvas.getContext('2d');
const w = canvas.width, h = canvas.height;
ctx.clearRect(0, 0, w, h);
const cx = w / 2, cy = h * 0.7;
const r = Math.min(w * 0.4, h * 0.6);
const start = Math.PI, end = 0;
ctx.lineWidth = 12;
ctx.lineCap = 'round';
ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border').trim() || '#252525';
ctx.beginPath();
ctx.arc(cx, cy, r, start, end, false);
ctx.stroke();
if (!isFinite(value)) return;
const clamped = Math.max(0, Math.min(100, value));
const angle = start + (end - start) * (clamped / 100);
ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7CFC00';
ctx.beginPath();
ctx.arc(cx, cy, r, start, angle, false);
ctx.stroke();
}
function drawDonutSplit(canvas, btcDom) {
if (!canvas) return;
const ctx = canvas.getContext('2d');
const w = canvas.width, h = canvas.height;
ctx.clearRect(0, 0, w, h);
const cx = w / 2, cy = h / 2, r = Math.min(w, h) * 0.3;
const inner = r * 0.6;
const border = getComputedStyle(document.documentElement).getPropertyValue('--border').trim() || '#252525';
const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7CFC00';
ctx.fillStyle = border;
ctx.beginPath();
ctx.arc(cx, cy, r, 0, Math.PI * 2);
ctx.fill();
ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--chip').trim() || '#1a1a1a';
ctx.beginPath();
ctx.arc(cx, cy, inner, 0, Math.PI * 2);
ctx.fill();
if (!isFinite(btcDom)) return;
const btc = Math.max(0, Math.min(100, btcDom));
const a0 = -Math.PI / 2;
const aB = a0 + (Math.PI * 2) * (btc / 100);
ctx.fillStyle = accent;
ctx.beginPath();
ctx.moveTo(cx, cy);
ctx.arc(cx, cy, r, a0, aB, false);
ctx.closePath();
ctx.fill();
}
function drawAllIndicatorVisuals(data) {
drawGauge(document.getElementById('fg_canvas'), data?.fgVal);
drawDonutSplit(document.getElementById('dom_canvas'), data?.btcDom);
const fgBig = document.getElementById('fg_big');
const fgSub = document.getElementById('fg_sub');
const domBig = document.getElementById('dom_big');
const domSub = document.getElementById('dom_sub');
if (isFinite(data?.fgVal)) {
fgBig.textContent = String(Math.round(data.fgVal));
fgSub.textContent = data.fgClass || '‚Äî';
} else {
fgBig.textContent = '‚Äî';
fgSub.textContent = '‚Äî';
}
if (typeof data?.btcDom === 'number' && isFinite(data.btcDom)) {
domBig.textContent = `BTC ${data.btcDom.toFixed(1)}%`;
domSub.textContent = `ALTS ${(100 - data.btcDom).toFixed(1)}%`;
} else {
domBig.textContent = '‚Äî';
domSub.textContent = '‚Äî';
}
}
const cached = loadIndicatorsCache();
if (cached?.data) {
lastIndicators = cached.data;
fgText.textContent = isFinite(lastIndicators.fgVal) ? `${lastIndicators.fgVal} ¬∑ ${lastIndicators.fgClass}` : '‚Äî';
tcapText.textContent = isFinite(lastIndicators.totalMc) ? '$' + Number(lastIndicators.totalMc).toLocaleString() : '‚Äî';
altText.textContent = isFinite(lastIndicators.altDom) ? lastIndicators.altDom.toFixed(2) + '%' : '‚Äî';
moodEl.textContent = computeMood(lastIndicators.fgVal);
indNote.textContent = t('Cached data');
drawAllIndicatorVisuals(lastIndicators);
}
document.getElementById('refresh_ind').addEventListener('click', fetchIndicators);
const HISTORY_KEY = 'tc_history';
function loadHistory() {
try {
return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
} catch(e) {
return [];
}
}
function saveHistory(arr) {
try {
localStorage.setItem(HISTORY_KEY, JSON.stringify(arr));
} catch(e) {}
}
function renderHistory() {
const list = document.getElementById('history_list');
list.innerHTML = '';
const arr = loadHistory();
if (!arr.length) {
return;
}
arr.forEach((it, idx) => {
if (idx >= 20) return;
const node = document.createElement('div');
node.className = 'hist-item';
const dt = new Date(it.t).toLocaleString();
const left = document.createElement('div');
left.innerHTML = `<b>${it.type}</b><div class="small">${dt}</div><div class="small">${it.summary}</div>`;
const right = document.createElement('div');
right.className = 'hist-actions';
const btnCopy = document.createElement('button');
btnCopy.className = 'mini';
btnCopy.textContent = t('Copy');
btnCopy.addEventListener('click', async () => {
const ok = await copyText(it.summary);
if (ok) showToast(t('Copied!'));
});
right.appendChild(btnCopy);
node.appendChild(left);
node.appendChild(right);
list.appendChild(node);
});
}
document.getElementById('open_terms').addEventListener('click', () => {
window.open('/terms.html', '_blank');
});
document.getElementById('open_privacy').addEventListener('click', () => {
window.open('/privacy.html', '_blank');
});
document.getElementById('open_support').addEventListener('click', () => {
window.open('https://t.me/ChalovSupportBot', '_blank');
});
document.getElementById('link_telegram').addEventListener('click', (e) => {
e.preventDefault();
window.open('https://t.me/ChalovCrypto', '_blank');
});
document.getElementById('link_youtube').addEventListener('click', (e) => {
e.preventDefault();
window.open('https://www.youtube.com/@ChalovCrypto', '_blank');
});
const modalBackdrop = document.getElementById('modal_backdrop');
const modalClose = document.getElementById('modal_close');
const cardCanvas = document.getElementById('card_canvas');
const btnSave = document.getElementById('card_save');
const btnCopyImg = document.getElementById('card_copy');
function openModal() {
modalBackdrop.style.display = 'flex';
}
function closeModal() {
modalBackdrop.style.display = 'none';
}
modalClose.addEventListener('click', closeModal);
modalBackdrop.addEventListener('click', (e) => {
if (e.target === modalBackdrop) closeModal();
});
function drawCard() {
const ctx = cardCanvas.getContext('2d');
const w = cardCanvas.width, h = cardCanvas.height;
ctx.clearRect(0, 0, w, h);
const theme = document.documentElement.getAttribute('data-theme');
const bg = theme === 'light' ? '#f5f7fa' : '#0a0a0a';
const panel = theme === 'light' ? '#ffffff' : '#111111';
const text = theme === 'light' ? '#1a1a1a' : '#ffffff';
const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
ctx.fillStyle = bg;
ctx.fillRect(0, 0, w, h);
ctx.fillStyle = panel;
ctx.fillRect(20, 20, w - 40, h - 40);
ctx.fillStyle = text;
ctx.font = 'bold 24px Inter';
ctx.fillText('Trader Calculator', 40, 60);
const tab = activeTab();
let title = t('Trade Card');
let data = [];
if (tab === 'dca') {
title = 'DCA Calculation';
data = [
`AVG: ${dcaAvgEl.textContent}`,
`VOL: ${dcaTotalVolEl.textContent}`,
`COST: ${dcaTotalCostEl.textContent}`
];
} else if (tab === 'rr') {
title = 'Risk/Reward';
data = [
`Gross: ${rrGross.textContent}`,
`Net: ${rrNet.textContent}`
];
} else if (tab === 'cap') {
title = 'Capital Management';
data = [
`POS: ${capPos.textContent}`,
`Risk: $${capRiskUsd.textContent}`,
`Margin: $${capMargin.textContent}`
];
}
ctx.fillStyle = accent;
ctx.font = 'bold 20px Inter';
ctx.fillText(title, 40, 100);
ctx.fillStyle = text;
ctx.font = '16px Inter';
data.forEach((line, i) => {
ctx.fillText(line, 40, 140 + i * 30);
});
ctx.fillStyle = accent;
ctx.beginPath();
ctx.moveTo(40, 180);
ctx.lineTo(w - 40, 180);
ctx.stroke();
ctx.fillStyle = '#666';
ctx.font = '12px Inter';
ctx.fillText(new Date().toLocaleDateString(), 40, h - 30);
}
function saveCardUniversal() {
cardCanvas.toBlob((blob) => {
const url = URL.createObjectURL(blob);
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
if (isMobile) {
const link = document.createElement('a');
link.href = url;
link.download = 'trade-card.png';
document.body.appendChild(link);
try {
link.click();
} catch (e) {
const newWindow = window.open(url, '_blank');
if (!newWindow) {
showToast('Please allow popups to save image');
}
}
setTimeout(() => {
document.body.removeChild(link);
URL.revokeObjectURL(url);
}, 100);
} else {
const link = document.createElement('a');
link.href = url;
link.download = 'trade-card.png';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url);
}
showToast(t('Image saved'));
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('card_saved', { method: isMobile ? 'mobile' : 'desktop' });
}
}, 'image/png');
}
btnSave.addEventListener('click', saveCardUniversal);
btnCopyImg.addEventListener('click', async () => {
cardCanvas.toBlob(async (blob) => {
try {
await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
showToast(t('Copied!'));
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('card_copied');
}
} catch (e) {
saveCardUniversal();
}
}, 'image/png');
});
document.getElementById('card_btn').addEventListener('click', () => {
drawCard();
openModal();
onAchievementEvent('card_opened');
});
const TONCONNECT_MANIFEST_URL = 'https://trade-calculator-five.vercel.app/tonconnect-manifest.json';
const TIP_ADDRESS = 'UQD04FKshVmZaQjZq9y2AtBXWklkzQfK4sEJWrsYfqbNHGGz';
let tonConnectUI = null;
function initTonConnect() {
try {
if (!window.TON_CONNECT_UI?.TonConnectUI) return;
tonConnectUI = new window.TON_CONNECT_UI.TonConnectUI({
manifestUrl: TONCONNECT_MANIFEST_URL
});
tonConnectUI.onStatusChange(() => {
updateWalletUI();
});
updateWalletUI();
} catch(e) {
console.error('TON Connect init error:', e);
}
}
function updateWalletUI() {
const wBtn = document.getElementById('wallet_btn');
const tipBtn = document.getElementById('tip_btn');
if (!tonConnectUI) {
wBtn.disabled = true;
tipBtn.disabled = true;
return;
}
wBtn.disabled = false;
tipBtn.disabled = !tonConnectUI.connected;
if (tonConnectUI.connected) {
const addr = tonConnectUI.account?.address || '';
wBtn.textContent = addr.slice(0, 6) + '...' + addr.slice(-4);
} else {
wBtn.textContent = t('Connect Wallet');
}
}
document.getElementById('wallet_btn').addEventListener('click', async () => {
if (!tonConnectUI) return;
if (tonConnectUI.connected) {
const confirm = window.confirm(t('Disconnect wallet?'));
if (confirm) {
await tonConnectUI.disconnect();
updateWalletUI();
}
} else {
await tonConnectUI.openModal();
}
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('wallet_action', {
action: tonConnectUI.connected ? 'disconnect' : 'connect_attempt'
});
}
});
document.getElementById('tip_btn').addEventListener('click', async () => {
if (!tonConnectUI?.connected) {
showToast(t('Connect wallet first'));
return;
}
try {
const tx = {
validUntil: Math.floor(Date.now() / 1000) + 600,
messages: [{
address: TIP_ADDRESS,
amount: '50000000'
}]
};
await tonConnectUI.sendTransaction(tx);
showToast(t('Transaction sent'));
onAchievementEvent('tip_sent');
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('tip_sent');
}
} catch(e) {
showToast(t('Error'));
}
});
initTonConnect();
document.getElementById('premium_back_btn').addEventListener('click', () => setMainTab('calc'));

// Premium themes
document.querySelectorAll('[data-premium-theme]').forEach(btn => {
btn.addEventListener('click', () => {
const theme = btn.getAttribute('data-premium-theme');
if (!requirePremium(t('Premium Themes'))) return;
document.documentElement.setAttribute('data-premium-theme', theme);
localStorage.setItem('tc_premium_theme', theme);
try{ onAchievementEvent('premium_theme_applied'); }catch(e){}
showToast(`${t('Premium Themes')}: ${theme}`);
});
});

try {
const savedTheme = localStorage.getItem('tc_premium_theme');
if (savedTheme) document.documentElement.setAttribute('data-premium-theme', savedTheme);
} catch(e){}

async function createTonOrder(plan){
const initData = getInitData();
if (!initData) throw new Error('no_initdata');
const resp = await fetch(`${API_BASE}/api/ton/order?plan=${encodeURIComponent(plan)}`, {
method:'GET',
headers:{ 'X-Telegram-Init-Data': initData }
});
const data = await resp.json();
if (!data?.ok) throw new Error(data?.error || 'order_failed');
return data;
}
async function confirmTonOrder(orderId){
const initData = getInitData();
if (!initData) throw new Error('no_initdata');
const resp = await fetch(`${API_BASE}/api/ton/confirm`, {
method:'POST',
headers:{ 'content-type':'application/json', 'X-Telegram-Init-Data': initData },
body: JSON.stringify({ orderId })
});
const data = await resp.json();
if (!data?.ok) throw new Error(data?.error || 'confirm_failed');
return data;
}
function setButtonLoading(button, isLoading) {
if (!button) return;
if (isLoading) {
button.classList.add('loading');
button.disabled = true;
} else {
button.classList.remove('loading');
button.disabled = false;
}
}
async function payTonPlan(plan, button){
if (!tonConnectUI?.connected) {
showToast(t('Connect wallet in the support tab'));
return;
}
setButtonLoading(button, true);
try{
const order = await createTonOrder(plan);
const tx = {
validUntil: order.validUntil,
messages: [{
address: order.receiver,
amount: order.amountNano
}]
};
await tonConnectUI.sendTransaction(tx);
showToast(t('Transaction sent'));
try{
const res = await confirmTonOrder(order.orderId);
if (res.granted) {
showToast(t('Premium activated'));
await refreshPremiumStatus();
} else {
showToast(t('Waiting for confirmation'));
window.__lastTonOrderId = order.orderId;
}
}catch(e){
let errMsg = t('Error');
if (e.response) {
try {
const errData = await e.response.json();
errMsg = errData.error || errMsg;
} catch {}
} else if (e.message) {
errMsg = e.message;
}
showToast(errMsg);
window.__lastTonOrderId = order.orderId;
}
}catch(e){
let errMsg = t('Error');
if (e.response) {
try {
const errData = await e.response.json();
errMsg = errData.error || errMsg;
} catch {}
} else if (e.message) {
errMsg = e.message;
}
showToast(errMsg);
console.error(e);
} finally {
setButtonLoading(button, false);
}
}
async function handleCheckPayment(button) {
const orderId = window.__lastTonOrderId;
if (!orderId) { showToast(t('No pending payment')); return; }
setButtonLoading(button, true);
try{
const res = await confirmTonOrder(orderId);
if (res.granted) {
showToast(t('Premium activated'));
await refreshPremiumStatus();
window.__lastTonOrderId = null;
} else {
showToast(t('Waiting for confirmation'));
}
}catch(e){
showToast(t('Waiting for confirmation'));
} finally {
setButtonLoading(button, false);
}
}
async function openStarsInvoice(plan, button){
if (!tg || !tg.openInvoice) { showToast('tg.openInvoice not available'); return; }
const initData = getInitData();
if (!initData) { showToast('No initData (open inside Telegram)'); return; }
setButtonLoading(button, true);
try{
const resp = await fetch(`${API_BASE}/api/stars/invoice?plan=${encodeURIComponent(plan)}`, {
method:'GET',
headers:{ 'X-Telegram-Init-Data': initData }
});
const text = await resp.text();
let data = null;
try { data = JSON.parse(text); } catch {}
if (!resp.ok) {
showToast(`API ${resp.status}: ${data?.error || text}`);
setButtonLoading(button, false);
return;
}
if (!data?.ok || !data.url) {
showToast(`API: ${data?.error || text || 'bad response'}`);
setButtonLoading(button, false);
return;
}
tg.openInvoice(data.url, async (status) => {
showToast(`Invoice status: ${status}`);
if (status === 'paid') {
await refreshPremiumStatus();
}
setButtonLoading(button, false);
});
}catch(e){
console.error(e);
showToast(`Exception: ${e?.message || e}`);
setButtonLoading(button, false);
}
}

// AI Tips
const aiTips = [
"Consider buying on dip, RSI oversold.",
"Market momentum is strong, consider trailing stop.",
"Fear & Greed indicates greed ‚Äì be cautious.",
"BTC dominance rising, altcoins may weaken.",
"Volume spike detected, watch for breakout."
];
const aiTipText = document.getElementById('ai_tip_text');
const aiRefreshBtn = document.getElementById('ai_refresh_btn');
function refreshAITip() {
if (!requirePremium('AI Tips')) return;
const randomTip = aiTips[Math.floor(Math.random() * aiTips.length)];
aiTipText.textContent = randomTip;
}
if (aiRefreshBtn) {
aiRefreshBtn.addEventListener('click', refreshAITip);
}

// Analytics
document.getElementById('analytics_btn').addEventListener('click', () => {
if (!requirePremium('Trade Analytics')) return;
const history = loadHistory();
if (history.length === 0) {
showToast('No history data');
return;
}
const totalTrades = history.length;
showToast(`Analytics: ${totalTrades} trades saved`);
onAchievementEvent('analytics_view');
});

// Priority Support
document.getElementById('priority_support_btn').addEventListener('click', () => {
if (!requirePremium('Priority Support')) return;
window.open('https://t.me/ChalovSupportBot?start=priority', '_blank');
});

// Font selector
const fontInter = document.getElementById('font_inter');
const fontRoboto = document.getElementById('font_roboto');
function setFont(font) {
document.documentElement.setAttribute('data-font', font);
localStorage.setItem('tc_font', font);
}
const savedFont = localStorage.getItem('tc_font') || 'inter';
setFont(savedFont);
if (fontInter && fontRoboto) {
fontInter.addEventListener('click', () => {
if (!requirePremium('Font selection')) return;
setFont('inter');
});
fontRoboto.addEventListener('click', () => {
if (!requirePremium('Font selection')) return;
setFont('roboto');
});
}

renderPremiumStatus();
translateAll();
if (!isUnlocked('first_launch')) unlockAchievement('first_launch');
renderAchievements();
clearDCA();
calcRR();
calcCap();
renderHistory();
if (window.TelegramAnalytics) {
window.TelegramAnalytics.trackEvent('app_loaded');
}
})();
</script>
</body>
</html>
